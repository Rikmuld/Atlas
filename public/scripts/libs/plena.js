var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},gl,Plena;!function(t){function e(e,o,n,s,u,h,l,A){var v,w,_,T;"number"==typeof h?(v=h,w=l,_=s,T=u,A&&(y=A)):"number"==typeof u?(v=s,w=u,_=window.innerWidth/2-v/2,T=window.innerHeight/2-w/2,h&&(y=h)):(v=window.innerWidth,w=window.innerHeight,_=0,T=0,s&&(y=s)),d=document.createElement("canvas"),d.setAttribute("width",""+v),d.setAttribute("height",""+w),d.setAttribute("style","position:fixed; top:"+T+"px; left:"+_+"px"),document.body.appendChild(d),t.canvasX=_,t.canvasY=T,t.width=v,t.height=w,gl=d.getContext("webgl")||d.getContext("experimental-webgl"),gl.viewport(0,0,v,w),gl.enable(gl.BLEND),gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),y.clearcolor(),gl.clear(gl.COLOR_BUFFER_BIT),Keyboard.enable(),Mouse.enable(),Shader.initBasicShaders(),E=p(),E.addShader(Shader.getShader(Shader.COLOR)),E.addShader(Shader.getShader(Shader.TEXTURE)),f=o,c=n,m=Views.createView(),g=Date.now(),e(),R=Assets.getQueue(),R>0?(r("Started loading assets, total: "+R),Assets.addQueueListner(i)):a()}function i(t){r("Loading Assets... progress "+(R-t)+"/"+R+" assets"),0==t&&(r(Assets.hasError()?"Assets loading finished with errors":"Assets loading finished without error"),g=Date.now(),a())}function r(t){A&&console.log(t)}function o(){A=!1}function n(t){y=t,t.clearcolor()}function s(){return y}function a(){gl.clear(gl.COLOR_BUFFER_BIT);var t=Date.now(),e=t-g;g=t,m.view(),f(e),c(e),E.render(),requestAnimationFrame(a)}function u(){return m}function h(){E.render()}function l(){return E}function p(){return new v}var f,c,d,g,m,E,A=!0,y=Color.White.WHITE,R=0;t.init=e,t.log=r,t.suppresLog=o,t.setColor=n,t.getCurrCol=s,t.getDefaultView=u,t.forceRender=h,t.manager=l,t.createManager=p;var v=function(){function t(){this.shaders=new TreeMap(STRING_COMPARE),this.grixs=new DeepTreeMap(STRING_COMPARE)}return t.prototype.hasShader=function(t){return this.shaders.contains(t)},t.prototype.addShader=function(t){this.shaders.put(t.getId(),t)},t.prototype.getShader=function(t){return this.shaders.apply(t)},t.prototype.addGrix=function(t,e){this.grixs.put("string"==typeof t?t:t.getId(),e)},t.prototype.render=function(){for(var t=this.shaders.itterator(),e=0;e<t.length;e++){var i=t[e];i[1].bind();for(var r=this.grixs.itterator(i[0]),o=0;o<r.length;o++)r[o].doRenderAll()}},t}()}(Plena||(Plena={}));var Views;!function(t){function e(t){return void 0===t&&(t=!0),new i(t)}var i=(new TreeMap(STRING_COMPARE),function(){function t(t){this.viewM=Matrix4.identity(),this.shaders=[],this.defaultShaders=t,this.changeProjection(0,Plena.width,Plena.height,0)}return t.prototype.addShaders=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];this.shaders=this.shaders.concat(t)},t.prototype.bindCamera=function(t){this.camera=t},t.prototype.bindCameraTo=function(t){this.camera||(this.camera=new r),this.camera.bindTo(t)},t.prototype.fixedResolutionH=function(t){this.changeProjection(t*(window.innerWidth/window.innerHeight),t)},t.prototype.fixedResolutionW=function(t){this.changeProjection(t,t*(window.innerHeight/window.innerWidth))},t.prototype.changeProjection=function(t,e,i,r){"number"==typeof i?this.projectionData=[t,e,i,r]:this.projectionData=[0,t,e,0],this.setProjection(this.projectionData)},t.prototype.setProjection=function(t){this.projectionM=Matrix4.ortho(t[0],t[1],t[2],t[3])},t.prototype.getProjection=function(t){return void 0===t&&(t=!1),t?this.projectionM:this.projectionData},t.prototype.getView=function(){return this.viewM},t.prototype.view=function(){Plena.forceRender(),this.camera&&(this.camera.update(),this.viewM=this.camera.getViewMatrix());for(var t=this.getShaders(),e=0;e<t.length;e++){var i=t[e];i.bind(),i.getMatHandler().setProjectionMatrix(this.projectionM),i.getMatHandler().setViewMatrix(this.viewM)}},t.prototype.getShaders=function(){var t=this.shaders;return this.defaultShaders&&(t=t.concat(Shader.getBasicShaders())),t},t.prototype.getWidth=function(){return this.mapX(Plena.width)},t.prototype.getHeight=function(){return this.mapY(Plena.height)},t.prototype.mapX=function(t,e){var i=this.projectionData[0],r=this.projectionData[1];return i+Math.abs(r-i)/Plena.width*(t-(e?Plena.canvasX:0))},t.prototype.mapY=function(t,e){var i=this.projectionData[3],r=this.projectionData[2];return i+Math.abs(r-i)/Plena.height*(t-(e?Plena.canvasY:0))},t}());t.View=i,t.createView=e;var r=function(){function t(t,e){this.x=0,this.y=0,"number"==typeof t?this.setView(t,e):t&&this.bindTo(t)}return t.prototype.setView=function(t,e){this.x=t,this.y=e},t.prototype.getX=function(){return this.x},t.prototype.getY=function(){return this.y},t.prototype.setX=function(t){this.x=t},t.prototype.setY=function(t){this.y=t},t.prototype.getViewMatrix=function(){return Matrix4.translate(-this.x,-this.y)},t.prototype.update=function(){this.x=this.entity.getX(),this.y=this.entity.getY()},t.prototype.bindTo=function(t){this.entity=t},t}();t.Camera=r}(Views||(Views={}));var Assets;!function(t){function e(t,e,i){void 0===t&&(t=!1),void 0===e&&(e=!1),void 0===i&&(i=!1);var r={};return r.smooth=t,r.safe=e,r.repeat=i,r}function i(t){M.push(t)}function r(){for(var t=0;t<M.length;t++){var e=M[t];e(T)}}function o(){return C}function n(){return T}function s(){T++,r()}function a(){T--,r()}function u(t,e){return function(){C=!0,Plena.log("Cannot load "+t+" file with souorce: "+e+", skipping..."),a()}}function h(e,i){void 0===i&&(i=t.PIXEL_NORMAL);var r=gl.createTexture(),o=new Img(r),n=new Image;return s(),n.onload=l(n,o,r),n.onerror=u("image",e),n.src=e,o}function l(t,i,r){return function(){if(MMath.isPowerOf2(t.height)&&MMath.isPowerOf2(t.width))i.imgLoaded(t.width,t.height,0,0,t.width,t.height,!1),w(t,r,e);else{var o=c(Math.pow(2,Math.ceil(MMath.logN(2,t.width))),Math.pow(2,Math.ceil(MMath.logN(2,t.height)))),n=o.canvas;o.drawImage(t,0,0),i.imgLoaded(n.width,n.height,0,0,t.width,t.height,!1),w(o,r,e)}a()}}function p(e,i){return void 0===i&&(i=t.PIXEL_NORMAL),new Sprite(h(e,i),i.safe)}function f(t){var e=new Audio;return s(),e.oncanplaythrough=a,e.onerror=u("audio",t),e.src=t,new AudioObj(e)}function c(t,e){var i=document.createElement("canvas");return i.width=t,i.height=e,i.getContext("2d")}function d(e,i,r,o,n){return void 0===i&&(i=t.LETTERS),g(e)?new FontMap(e,i,r,o,n):new FontMap(e,i,r)}function g(t){return t.getFontSize?!0:!1}function m(e,i,r,o,n,s,a){return void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=t.NORMAL),new WritableImg(r,o,e,i,n,s,a.smooth,a.repeat)}function E(e,i,r,o,n,s){void 0===o&&(o=-1),void 0===n&&(n=0),r||(r=t.LETTERS);var a=gl.createTexture(),u=new Img(a),h=document.createElement("canvas"),l=h.getContext("2d");i.apply(l);var p;o>=0&&(p=y(e,o,l),o=Math.max(o,A(l,p)));var f=o>=0?o:l.measureText(e).width+3,c=p?p.length*(i.getFontSize()+n)-n:i.getFontSize(),d="center"==i.getAlign()?f/2:"right"==i.getAlign()?f:0;if(c=c+=i.getFontSize(),h.width=Math.pow(2,Math.ceil(MMath.logN(2,f))),h.height=Math.pow(2,Math.ceil(MMath.logN(2,c))),u.imgLoaded(h.width,h.height,0,0,f,c,!1),i.apply(l),s&&(l.fillStyle=s.style(),l.fillRect(0,0,f,c)),p){if(i.getFill()){l.fillStyle=i.getFill();for(var g=0;g<p.length;g++)l.fillText(p[g],d,g*(i.getFontSize()+n)+i.getFontSize()/2)}if(i.getStroke()){l.strokeStyle=i.getStroke();for(var g=0;g<p.length;g++)l.strokeText(p[g],d,g*(i.getFontSize()+n)+i.getFontSize()/2)}}else i.getFill()&&(l.fillStyle=i.getFill(),l.fillText(e,d,i.getFontSize()/2)),i.getStroke()&&(l.strokeStyle=i.getStroke(),l.strokeText(e,d,i.getFontSize()/2));return w(l,a,r),u}function A(t,e){for(var i=0,r=0;r<e.length;r++){var o=e[r],n=t.measureText(o).width;n>i&&(i=n)}return i}function y(t,e,i){for(var r=[],o=t.split(" "),n="",s=0;s<o.length;s++){var a=o[s];if(0==n.length)n=a;else{var u=n+" "+a;i.measureText(u).width>e?(r.push(n),n=a):n=u}}return n.length>0&&r.push(n),r}function R(t,e){return new Font(t,e)}function v(e,i){void 0===i&&(i=t.PIXEL_NORMAL);var r;r=_(e)?e:e.getContext("2d");var o=r.canvas,n=o.width,s=o.height,a=gl.createTexture(),u=new Img(a),h=r.getImageData(0,0,n,s);return o.width=Math.pow(2,Math.ceil(MMath.logN(2,n))),o.height=Math.pow(2,Math.ceil(MMath.logN(2,s))),u.imgLoaded(o.width,o.height,0,0,n,s,i.safe),r.putImageData(h,0,0),w(r,a,i),u}function w(t,e,i){if(gl.bindTexture(gl.TEXTURE_2D,e),_(t)){var r=t.canvas;gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,t.getImageData(0,0,r.width,r.height))}else gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,t);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,i.smooth?gl.LINEAR:gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,i.smooth?gl.LINEAR_MIPMAP_NEAREST:gl.NEAREST_MIPMAP_NEAREST),i.repeat&&gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.REPEAT),gl.generateMipmap(gl.TEXTURE_2D),gl.bindTexture(gl.TEXTURE_2D,null)}function _(t){return t.canvas?!0:!1}var T=0,M=[],C=!1;t.NORMAL=e(!0,!1,!1),t.PIXEL_NORMAL=e(!1,!1,!1),t.LETTERS=e(!0,!0,!1),t.TILE_SHEET=e(!0,!0,!1),t.PIXEL_TILE_SHEET=e(!1,!0,!1),t.BACKGROUND=e(!0,!1,!0),t.PIXEL_BACKGROUND=e(!1,!1,!0),t.options=e,t.addQueueListner=i,t.hasError=o,t.getQueue=n,t.loadImg=h,t.loadSprite=p,t.loadAudio=f,t.mkCanvas=c,t.mkFontMap=d,t.mkWritableImg=m,t.mkTextImg=E,t.getFont=R,t.getTexture=v}(Assets||(Assets={}));var TexCoord=function(){function t(t,e,i,r,o,n,s){this.minX=(t+(s?.5:0))/o,this.minY=(e+(s?.5:0))/n,this.maxX=t/o+(i-(s?.5:0))/o,this.maxY=e/n+(r-(s?.5:0))/n,this.width=i,this.height=r}return t.prototype.widthFHeight=function(t){return(this.maxX-this.minX)/(this.maxY-this.minY)*t},t.prototype.heightFWidth=function(t){return(this.maxY-this.minY)/(this.maxX-this.minX)*t},t.prototype.getXMax=function(){return this.maxX},t.prototype.getXMin=function(){return this.minX},t.prototype.getYMax=function(){return this.maxY},t.prototype.getYMin=function(){return this.minY},t}(),Img=function(){function t(t){this.callbackLoaded=new Queue,this.isLoaded=!1,this.texture=t}return t.prototype.imgLoaded=function(t,e,i,r,o,n,s){this.sizeX=t,this.sizeY=e,this.width=o,this.height=n,this.coord=new TexCoord(i,r,o,n,t,e,s),this.isLoaded=!0;for(var a=this.callbackLoaded.size(),u=0;a>u;u++)this.callbackLoaded.dequeue()(this);this.callbackLoaded=null},t.prototype.onLoaded=function(t){0==this.isLoaded?this.callbackLoaded.enqueue(t):t(this)},t.prototype.getCoord=function(){return this.coord},t.prototype.bind=function(){gl.bindTexture(gl.TEXTURE_2D,this.texture)},t.prototype.loaded=function(){return this.isLoaded},t.prototype.maxX=function(){return this.sizeX},t.prototype.maxY=function(){return this.sizeY},t.prototype.getWidth=function(){return this.width},t.prototype.getHeight=function(){return this.height},t.prototype.getGLTexture=function(){return this.texture},t}(),Sprite=function(){function t(t,e){this.img=t,this.subImages=new TreeMap(STRING_COMPARE),e&&(this.safe=!0)}return t.prototype.onLoaded=function(t){this.img.onLoaded(t)},t.prototype.getImgs=function(){return this.subImages.values()},t.prototype.getImgNames=function(){return this.subImages.keys()},t.prototype.addImg=function(t,e,i,r,o){return this.img.onLoaded(this.do_addImg(this,t,e,i,r,o)),this},t.prototype.addImgs=function(t,e,i,r,o,n,s){return this.img.onLoaded(this.do_addImgs(this,t,e,i,r,o,n,s)),this},t.prototype.addAnimImgs=function(t,e,i,r,o,n,s){return this.img.onLoaded(this.do_addImgs(this,t,e,i,r,o,n,s)),this},t.prototype.getAnims=function(){return this.animations.values()},t.prototype.getAnim=function(t){return this.animations.apply(t)},t.prototype.getAnimNames=function(){return this.animations.keys()},t.prototype.arbAnimName=function(){return this.animations.min()},t.prototype.arbAnim=function(){return this.animations.apply(this.arbAnimName())},t.prototype.hasAnime=function(){return null!=this.animations&&this.animations.size()>0},t.prototype.hasSubImg=function(){return null!=this.subImages&&this.subImages.size()>0},t.prototype.do_addImgs=function(t,e,i,r,o,n,s,a){return function(u){var h,l,p=!1;"string"==typeof e&&(h=[],p=!0);for(var f=0;s>f;f++){a=1==a?!0:!1,l="string"==typeof e?e+"_"+f:e[f];var c;c=a?Math.floor((u.getHeight()-r)/n):Math.floor((u.getWidth()-i)/o);var d=a?f%c:Math.floor(f/c),g=a?Math.floor(f/c):f%c,m=new Img(u.getGLTexture());m.imgLoaded(u.maxX(),u.maxY(),i+g*o,r+d*n,o,n,t.safe),p?h.push(m):t.subImages.put(l,m)}p&&(null==t.animations&&(t.animations=new TreeMap(STRING_COMPARE)),t.animations.put(e,h))}},t.prototype.do_addImg=function(t,e,i,r,o,n){return function(s){var a=new Img(s.getGLTexture());a.imgLoaded(s.maxX(),s.maxY(),i,r,o,n,t.safe),t.subImages.put(e,a)}},t.prototype.bind=function(){this.img.bind()},t.prototype.getBaseImg=function(){return this.img},t.prototype.getImg=function(t){return this.subImages.apply(t)},t.prototype.arbImgName=function(){return this.subImages.min()},t.prototype.arbImg=function(){return this.subImages.apply(this.arbImgName())},t.prototype.hasImg=function(t){return this.subImages.contains(t)},t}(),FontMap=function(){function t(e,i,r,o,n){if(void 0===r&&(r=t.BASIC_KEYS),this.dim=new TreeMap(STRING_COMPARE),e.getFontSize){o="number"==typeof o?o:2;var s=e,a=t.mkCharSet(r,o);this.fontMap=new Sprite(Assets.mkTextImg(a,s.align("left"),i,12*s.getFontSize(),20,n),i.safe);var u=document.createElement("canvas"),h=u.getContext("2d");s.apply(h),this.size=s.getFontSize(),this.spaceWidth=h.measureText(" ").width;for(var l=a.replace(/\s/g,""),p=0,f=0,c=0;c<l.length;c++){var d=l.charAt(c),g=h.measureText(d).width,m=1.2*s.getFontSize();p+g>12*s.getFontSize()&&(p=0,f+=1*s.getFontSize()+20),this.fontMap.addImg(d,p,f,g,m),this.dim.put(d,[g,m]),p+=g+this.spaceWidth*o}}else{this.fontMap=e,this.spaceWidth=i,this.size=r;for(var E=this.fontMap.getImgs(),A=this.fontMap.getImgNames(),c=0;c<E.length;c++){var y=A[c],R=E[c];this.dim.put(y,[R.getWidth(),R.getHeight()])}}}return t.mkCharSet=function(t,e){void 0===e&&(e=2);for(var i=t.replace(/\s/g,""),r="",o=0;o<i.length;o++){if(o>0)for(var n=0;e>n;n++)r+=" ";r+=i.charAt(o)}return r},t.prototype.defaultSize=function(){return this.size},t.prototype.getMap=function(){return this.fontMap},t.prototype.getLetter=function(t){return this.fontMap.getImg(t)},t.prototype.spacing=function(){return this.spaceWidth},t.prototype.getDim=function(t){return this.dim.apply(t)},t.BASIC_KEYS="!@€\"#$%^&*()[]{}-=,.;:'></?\\|1234567890`~abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",t}(),WritableImg=function(){function t(t,e,i,r,o,n,s,a){o=o?o:i,n=n?n:r;var u=Math.pow(2,Math.ceil(MMath.logN(2,o))),h=Math.pow(2,Math.ceil(MMath.logN(2,n)));this.frame=new Framebuffer(u,h,o,n,s,a),this.img=new Img(this.frame.getTexture()),this.img.imgLoaded(u,h,0,0,o,n,!1),this.x=t,this.y=e,this.width=i,this.height=r}return t.prototype.setPos=function(t,e){this.x=t,this.y=e},t.prototype.getWidth=function(){return this.width},t.prototype.getHeight=function(){return this.height},t.prototype.startWrite=function(t){Plena.forceRender(),this.projectionSave=t.getProjection(),this.lastView=t,t.setProjection([this.x,this.x+this.width,this.y,this.y+this.height]),t.view(),this.frame.startRenderTo()},t.prototype.stopWrite=function(){Plena.forceRender(),this.frame.stopRenderTo(),this.lastView.setProjection(this.projectionSave),this.lastView.view()},t.prototype.getTexture=function(){return this.frame.getTexture()},t.prototype.getImg=function(){return this.img},t.prototype.bind=function(){this.img.bind()},t}(),Font=function(){function t(t,e){this.textAlign="left",this.fontsize=e,this.family=t}return t.prototype.getFontSize=function(){return this.fontsize},t.prototype.getFamily=function(){return this.family},t.prototype.getAlign=function(){return this.textAlign},t.prototype.getFill=function(){return this.textFill},t.prototype.getStroke=function(){return this.textStroke},t.prototype.apply=function(t){t.textAlign=this.getAlign(),t.textBaseline="middle",t.font=this.getFontSize()+"px "+this.getFamily()},t.prototype.size=function(t){return this.fontsize=t,this},t.prototype.fill=function(t){return this.textFill=t.style(),this},t.prototype.stroke=function(t){return this.textStroke=t.style(),this},t.prototype.align=function(t){return this.textAlign=t,this},t}(),Font;!function(t){t.ARIAL="Arial, 'Helvetica Neue', Helvetica, sans-serif",t.ARIAL_BOLD="'Arial Black', 'Arial Bold', Gadget, sans-serif",t.ARIAL_NARROW="'Arial Narrow', Arial, sans-serif",t.ARIAL_ROUNDED="'Arial Rounded MT Bold', 'Helvetica Rounded', Arial, sans-serif",t.CALIBRI="Calibri, Candara, Segoe, 'Segoe UI', Optima, Arial, sans-serif",t.CANDARA="Candara, Calibri, Segoe, 'Segoe UI', Optima, Arial, sans-serif",t.CENTURY_GOTHIC="'Century Gothic', CenturyGothic, AppleGothic, sans-serif",t.GILL_SANS="'Gill Sans', 'Gill Sans MT', Calibri, sans-serif",t.HELVETICA="'Helvetica Neue', Helvetica, Arial, sans-serif",t.TAHOMA="Tahoma, Verdana, Segoe, sans-serif",t.TREBUCHET_MS="'Trebuchet MS', 'Lucida Grande', 'Lucida Sans Unicode', 'Lucida Sans', Tahoma, sans-serif",t.VERDANA="Verdana, Geneva, sans-serif",t.BOOK_ANTIQUA="'Book Antiqua', Palatino, 'Palatino Linotype', 'Palatino LT STD', Georgia, serif",t.CAMBRIA="Cambria, Georgia, serif",t.GARAMOND="Garamond, Baskerville, 'Baskerville Old Face', 'Hoefler Text', 'Times New Roman', serif",t.GEORGRIA="Georgia, Times, 'Times New Roman', serif",t.LUCIDA_BRIGHT="'Lucida Bright', Georgia, serif",t.PALATINO="Palatino, 'Palatino Linotype', 'Palatino LT STD', 'Book Antiqua', Georgia, serif",t.BASKERVILLE="Baskerville, 'Baskerville Old Face', 'Hoefler Text', Garamond, 'Times New Roman', serif",t.TIMES_NEW_ROMAN="TimesNewRoman, 'Times New Roman', Times, Baskerville, Georgia, serif",t.CONSOLAS="Consolas, monaco, monospace",t.COURIER_NEW="'Courier New', Courier, 'Lucida Sans Typewriter', 'Lucida Typewriter', monospace",t.MONACO="monaco, Consolas, 'Lucida Console', monospace",t.COPPERPLATE="Copperplate, 'Copperplate Gothic Light', fantasy",t.PAPYRUS="Papyrus, fantasy",t.BRUSH_SCRIPT_MT="'Brush Script MT', cursive"}(Font||(Font={}));var AudioObj=function(){function t(t){this.audio=t}return t.prototype.play=function(){this.audio.play()},t.prototype.pause=function(){this.audio.pause()},t.prototype.isRunning=function(){!this.audio.paused},t.prototype.currentTime=function(){return this.audio.currentTime},t.prototype.setTime=function(t){this.audio.currentTime=t},t.prototype.duration=function(){return this.audio.duration},t.prototype.setRunSpeed=function(t){this.audio.playbackRate=t},t.prototype.audioElement=function(){return this.audio},t}(),Shader=function(){function t(e,i,r,o){this.shadVarData=[],this.id=e,t.addShader(this,e);var n,s;"undefined"==typeof o?(n=this.getShader(r+"-fs"),s=this.getShader(r+"-vs")):(n=this.createShader(o,gl.FRAGMENT_SHADER),s=this.createShader(r,gl.VERTEX_SHADER)),this.program=gl.createProgram(),gl.attachShader(this.program,s),gl.attachShader(this.program,n),gl.linkProgram(this.program),gl.getProgramParameter(this.program,gl.LINK_STATUS)||alert("Unable to initialize the shader program."),this.bind(),this.vertices=gl.getAttribLocation(this.program,"vertexPos"),this.UVCoords=gl.getAttribLocation(this.program,"vertexUV");for(var a in i)i.hasOwnProperty(a)&&(this.shadVarData[i[a]]=gl.getUniformLocation(this.program,a));this.matrix=new MatrixHandler(this)}return t.prototype.getId=function(){return this.id},t.prototype.getVerticesLoc=function(){return this.vertices},t.prototype.getUVLoc=function(){return this.UVCoords},t.prototype.getMatHandler=function(){return this.matrix},t.prototype.bind=function(){gl.useProgram(this.program)},t.prototype.setMatrix4=function(t,e){gl.uniformMatrix4fv(this.shadVarData[t],!1,new Float32Array(e))},t.prototype.setInt=function(t,e){gl.uniform1i(this.shadVarData[t],e)},t.prototype.setFloat=function(t,e){gl.uniform1f(this.shadVarData[t],e)},t.prototype.setVec2=function(t,e){gl.uniform2f(this.shadVarData[t],e[0],e[1])},t.prototype.setVec3=function(t,e){gl.uniform3f(this.shadVarData[t],e[0],e[1],e[2])},t.prototype.setVec4=function(t,e){gl.uniform4f(this.shadVarData[t],e[0],e[1],e[2],e[3])},t.prototype.createShader=function(t,e){var i=gl.createShader(e);return gl.shaderSource(i,t),gl.compileShader(i),gl.getShaderParameter(i,gl.COMPILE_STATUS)?i:(alert("An error occurred compiling the shaders: "+gl.getShaderInfoLog(i)),null)},t.prototype.getShader=function(t){var e,i,r;if(e=document.getElementById(t),!e)return null;for(i="",r=e.firstChild;r;)r.nodeType==r.TEXT_NODE&&(i+=r.textContent),r=r.nextSibling;return"x-shader/x-fragment"==e.type?this.createShader(i,gl.FRAGMENT_SHADER):"x-shader/x-vertex"==e.type?this.createShader(i,gl.VERTEX_SHADER):null},t}(),Shader;!function(t){function e(){n(a.COLOR,t.COLOR),n(a.TEXTURE,t.TEXTURE)}function i(){return[s.apply(t.COLOR),s.apply(t.TEXTURE)]}function r(t,e){s.put(e,t)}function o(t){return s.apply(t)}function n(e,i){var r;if(e==a.COLOR)r=new t(i,{projectionMatrix:t.Uniforms.PROJECTION_MATRIX,viewMatrix:t.Uniforms.VIEW_MATRIX,modelMatrix:t.Uniforms.MODEL_MATRIX,color:t.Uniforms.COLOR},t.Shaders.COLOR_V,t.Shaders.COLOR_F);else{if(e!=a.TEXTURE)return null;r=new t(i,{projectionMatrix:t.Uniforms.PROJECTION_MATRIX,viewMatrix:t.Uniforms.VIEW_MATRIX,modelMatrix:t.Uniforms.MODEL_MATRIX,UVMatrix:t.Uniforms.UV_MATRIX,color:t.Uniforms.COLOR},t.Shaders.TEX_V,t.Shaders.TEX_F),r.getMatHandler().setUVMatrix(Matrix4.identity()),r.setVec4(t.Uniforms.COLOR,Color.White.white(1).vec())}return r.getMatHandler().setModelMatrix(Matrix4.identity()),r.getMatHandler().setProjectionMatrix(Matrix4.identity()),r.getMatHandler().setViewMatrix(Matrix4.identity()),r}t.COLOR="plenaColorShader",t.TEXTURE="plenaTextureShader";var s=new TreeMap(STRING_COMPARE);t.initBasicShaders=e,t.getBasicShaders=i,t.addShader=r,t.getShader=o,function(t){t[t.COLOR=0]="COLOR",t[t.TEXTURE=1]="TEXTURE"}(t.ShaderType||(t.ShaderType={}));var a=t.ShaderType;t.createBasicShader=n;var u;!function(t){t.PROJECTION_MATRIX=100,t.VIEW_MATRIX=101,t.MODEL_MATRIX=102,t.UV_MATRIX=103,t.COLOR=104}(u=t.Uniforms||(t.Uniforms={}));var h;!function(t){t.COLOR_F="\n            precision highp float;\n\n            uniform vec4 color;\n\n            void main(void){\n                gl_FragColor = color;\n            }",t.COLOR_V="\n            precision highp float;\n\n            uniform mat4 modelMatrix;\n            uniform mat4 projectionMatrix;\n            uniform mat4 viewMatrix;\n\n            attribute vec2 vertexPos;\n\n            void main(void){\n                gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(vertexPos, 1, 1);\n            }",t.TEX_F="\n            precision highp float;\n\n            varying vec2 UV;\n\n            uniform sampler2D sampler;\n            uniform vec4 color;\n\n            void main(void){\n                gl_FragColor = texture2D(sampler, UV) * color;\n            }",t.TEX_V="\n            precision highp float;\n\n            uniform mat4 modelMatrix;\n            uniform mat4 projectionMatrix;\n            uniform mat4 viewMatrix;\n            uniform mat4 UVMatrix;\n\n            varying vec2 UV;\n\n            attribute vec2 vertexPos;\n            attribute vec2 vertexUV;\n\n            void main(void){\n                gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(vertexPos, 1, 1);\n                UV = (UVMatrix * vec4(vertexUV, 1, 1)).xy;\n            }"}(h=t.Shaders||(t.Shaders={}))}(Shader||(Shader={}));var MatrixHandler=function(){function t(t){this.projMat=Matrix4.identity(),this.viewMat=Matrix4.identity(),this.shader=t}return t.prototype.setProjectionMatrix=function(t){this.shader.setMatrix4(Shader.Uniforms.PROJECTION_MATRIX,t),this.projMat=t},t.prototype.setModelMatrix=function(t){this.shader.setMatrix4(Shader.Uniforms.MODEL_MATRIX,t)},t.prototype.setViewMatrix=function(t){this.shader.setMatrix4(Shader.Uniforms.VIEW_MATRIX,t),this.viewMat=t},t.prototype.setUVMatrix=function(t){this.shader.setMatrix4(Shader.Uniforms.UV_MATRIX,t)},t}(),Render=function(){function t(){this.attrpBuffs=[],this.attrpIds=[],this.elementBuff=[],this.count=[],this.verts=[],this.uv=[],this.indieces=[]}return t.prototype.addAttrips=function(t,e){this.attrpBuffs.push(t),this.attrpIds.push(e)},t.prototype.addToEnd=function(t,e){this.elementBuff.push(t),this.count.push(e)},t.prototype.populate=function(t){if(this.verts){this.shader=t,this.addVertexes(this.verts),this.uv.length>0&&this.addUVCoords(this.uv);for(var e=0,i=this.indieces;e<i.length;e++){var r=i[e];this.addIndieces(r)}delete this.verts,delete this.uv,delete this.indieces}else Plena.log("You cannot populate a renderer twice!")},t.prototype.pushVerts=function(t){this.verts?this.verts=this.verts.concat(t):Plena.log("You cannot add new vertices coords to an already populated renderer!")},t.prototype.pushUV=function(t){this.uv?this.uv=this.uv.concat(t):Plena.log("You cannot add new UV coords to an already populated renderer!")},t.prototype.pushIndices=function(t,e){t>this.indieces.length?Plena.log("Indiece Id is too high, use: "+this.indieces.length):t==this.indieces.length?this.indieces.push(e):this.indieces[t]=this.indieces[t].concat(e)},t.prototype.addVertexes=function(t){var e=gl.createBuffer(),i=this.shader.getVerticesLoc();gl.bindBuffer(gl.ARRAY_BUFFER,e),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(t),gl.STATIC_DRAW),gl.vertexAttribPointer(i,2,gl.FLOAT,!1,0,0),this.addAttrips(e,i)},t.prototype.addUVCoords=function(t){var e=gl.createBuffer(),i=this.shader.getUVLoc();gl.bindBuffer(gl.ARRAY_BUFFER,e),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(t),gl.STATIC_DRAW),gl.vertexAttribPointer(i,2,gl.FLOAT,!1,0,0),this.addAttrips(e,i)},t.prototype.addIndieces=function(t){var e=t.length,i=gl.createBuffer();gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,i),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(t),gl.STATIC_DRAW),this.addToEnd(i,e)},t.prototype.switchBuff=function(t){gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.elementBuff[t])},t.prototype.draw=function(t,e){gl.drawArrays(t,0,e)},t.prototype.drawElements=function(t,e){gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.elementBuff[t]),gl.drawElements(e,this.count[t],gl.UNSIGNED_SHORT,0)},t.prototype.drawSomeElements=function(t,e){for(var i=0;i<t.length;i++)t[i]&&(gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.elementBuff[i]),gl.drawElements(e,this.count[i],gl.UNSIGNED_SHORT,0))},t.prototype.start=function(){for(var t=0;t<this.attrpIds.length;t++)gl.enableVertexAttribArray(this.attrpIds[t]),gl.bindBuffer(gl.ARRAY_BUFFER,this.attrpBuffs[t]),gl.vertexAttribPointer(this.attrpIds[t],2,gl.FLOAT,!1,0,0)},t.prototype.end=function(){for(var t=0;t<this.attrpIds.length;t++)gl.disableVertexAttribArray(this.attrpIds[t])},t.prototype.drawElementsWithStartEnd=function(t,e){for(var i=0;i<this.attrpIds.length;i++)gl.enableVertexAttribArray(this.attrpIds[i]),gl.bindBuffer(gl.ARRAY_BUFFER,this.attrpBuffs[i]),gl.vertexAttribPointer(this.attrpIds[i],2,gl.FLOAT,!1,0,0);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.elementBuff[e]),gl.drawElements(t,this.count[e],gl.UNSIGNED_SHORT,0);for(var i=0;i<this.attrpIds.length;i++)gl.disableVertexAttribArray(this.attrpIds[i])},t.prototype.drawWithStartEnd=function(t,e){for(var i=0;i<this.attrpIds.length;i++)gl.enableVertexAttribArray(this.attrpIds[i]),gl.bindBuffer(gl.ARRAY_BUFFER,this.attrpBuffs[i]),gl.vertexAttribPointer(this.attrpIds[i],2,gl.FLOAT,!1,0,0);gl.drawArrays(t,0,e);for(var i=0;i<this.attrpIds.length;i++)gl.disableVertexAttribArray(this.attrpIds[i])},t}(),Framebuffer=function(){function t(t,e,i,r,o,n){this.frameTexture=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,this.frameTexture),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,t,e,0,gl.RGBA,gl.UNSIGNED_BYTE,null),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,o?gl.LINEAR:gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,o?gl.LINEAR_MIPMAP_NEAREST:gl.NEAREST_MIPMAP_NEAREST),n&&gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.REPEAT),this.frameBuffer=gl.createFramebuffer(),gl.bindFramebuffer(gl.FRAMEBUFFER,this.frameBuffer),this.frameBuffer.width=i,this.frameBuffer.height=r,gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,this.frameTexture,0),gl.bindTexture(gl.TEXTURE_2D,null),gl.bindFramebuffer(gl.FRAMEBUFFER,null)}return t.prototype.getTexture=function(){return this.frameTexture},t.prototype.startRenderTo=function(){gl.bindFramebuffer(gl.FRAMEBUFFER,this.frameBuffer),gl.clear(gl.COLOR_BUFFER_BIT),gl.viewport(0,0,this.frameBuffer.width,this.frameBuffer.height)},t.prototype.stopRenderTo=function(){gl.bindTexture(gl.TEXTURE_2D,this.frameTexture),gl.generateMipmap(gl.TEXTURE_2D),gl.bindFramebuffer(gl.FRAMEBUFFER,null),gl.viewport(0,0,Plena.width,Plena.height)},t.prototype.bindTexture=function(){gl.bindTexture(gl.TEXTURE_2D,this.frameTexture)},t}(),Grix=function(){function t(t){this.mode=gl.TRIANGLES,this.drawer=new Render,this.isFinal=!1,this.childs=new Queue,this.xT=0,this.yT=0,this.sXT=1,this.sYT=1,this.angle=0,this.pmX=0,this.pmY=0,this.prX=0,this.prY=0,this.relRotP=!0,this.mirrorX=!1,this.mirrorY=!1,this.drawer=new Render,t&&(this.customeShader=t,Plena.manager().hasShader(t.getId())||Plena.manager().addShader(t))}return t.prototype.start=function(){this.drawer.start()},t.prototype.end=function(){this.drawer.end()},t.prototype.doRenderAll=function(){this.start();for(var t=this.childs.size(),e=0;t>e;e++){var i=this.childs.dequeue();this.getShader().getMatHandler().setModelMatrix(i.transform),this.doRender(i)}this.end(),this.clean()},t.prototype.doRender=function(t){this.drawer.drawElements(0,this.mode)},t.prototype.populate=function(){return this.drawer.populate(this.getShader()),Plena.manager().addGrix(this.getShader(),this),this.isFinal=!0,this.clean(),this},t.prototype.isLoaded=function(){return!0},t.prototype.render=function(){if(this.isLoaded()){var t=this.width*this.getXScale()/2,e=this.height*this.getYScale()/2,i=Math.cos(this.angle),r=Math.sin(this.angle),o=t+this.xT,n=e+this.yT,s=this.mirrorX?-1:1,a=this.mirrorY?-1:1,u=this.relRotP?-t-this.prX*(2*t):-this.prX+this.xT,h=this.relRotP?-e-this.prY*(2*e):-this.prY+this.yT,l=this.getXScale()*s,p=this.getYScale()*a,f=o+(this.mirrorX?2*t:0)+(this.relRotP?this.prX*(2*t):this.prX-o)+i*u+-r*h,c=n+(this.mirrorY?2*e:0)+(this.relRotP?this.prY*(2*e):this.prY-n)+r*u+i*h,d=[i*l,r*l,0,0,-r*p,i*p,0,0,0,0,1,0,f,c,0,1];this.childs.enqueue(this.createGrixc(d))}},t.prototype.getXScale=function(){return this.sXT},t.prototype.getYScale=function(){return this.sYT},t.prototype.createGrixc=function(t){return{transform:t}},t.prototype.move=function(t,e){this.xT+=t,this.yT+=e},t.prototype.moveTo=function(t,e){this.moveXTo(t),this.moveYTo(e)},t.prototype.moveXTo=function(t){this.xT=t-this.width*this.getXScale()*this.pmX},t.prototype.moveYTo=function(t){this.yT=t-this.height*this.getYScale()*this.pmY},t.prototype.scale=function(t,e){this.sXT+=t,this.sYT+=e},t.prototype.scaleTo=function(t,e){this.sXT=t,this.sYT=e},t.prototype.scaleToSize=function(t,e){var i=t/this.width,r=e/this.height;this.scaleTo(i,r)},t.prototype.scaleWidthToSize=function(t){var e=t/this.width;this.scaleTo(e,e)},t.prototype.scaleHeightToSize=function(t){var e=t/this.height;this.scaleTo(e,e)},t.prototype.rotate=function(t){this.angle+=t},t.prototype.rotateTo=function(t){this.angle=t},t.prototype.rotateDeg=function(t){this.rotate(MMath.toRad(t))},t.prototype.rotateToDeg=function(t){this.rotateTo(MMath.toRad(t))},t.prototype.clean=function(){this.xT=0,this.yT=0,this.prY=0,this.prX=0,this.pmY=0,this.pmX=0,this.sXT=1,this.sYT=1,this.angle=0,this.relRotP=!0,this.mirrorX=!1,this.mirrorY=!1},t.prototype.mirrorHorizontal=function(t){this.mirrorX=t},t.prototype.mirrorVertical=function(t){this.mirrorY=t},t.prototype.setPivotRot=function(t,e,i){"boolean"==typeof i&&0==i?(this.relRotP=!1,this.prX=t,this.prY=e):(this.prX=t-.5,this.prY=e-.5,this.relRotP=!0)},t.prototype.setPivotMove=function(t,e){this.pmX=t,this.pmY=e},t.prototype.getWidth=function(){return this.width*this.getXScale()},t.prototype.getHeight=function(){return this.height*this.getYScale()},t}(),TexturedGrix=function(t){function e(){
t.apply(this,arguments),this.minX=Math.min(),this.minY=Math.min(),this.maxX=Math.max(),this.maxY=Math.max(),this.cound=0}return __extends(e,t),e.prototype.start=function(){t.prototype.start.call(this),this.getImg().bind()},e.prototype.getIndieces=function(t,e){return t.forEach(function(t,i,r){r[i]=t+4*e}),t},e.prototype.populate=function(){var e=this;return this.height=Math.abs(this.maxY-this.minY),this.width=Math.abs(this.maxX-this.minX),this.getImg().onLoaded(function(){t.prototype.populate.call(e)}),this},e.prototype.getShader=function(){return this.customeShader?this.customeShader:Shader.getShader(Shader.TEXTURE)},e.prototype.isLoaded=function(){return this.getImg().loaded()},e.prototype.addRect=function(t,e,i,r){this.drawer.pushVerts([i,r,i+t,r,i+t,r+e,i,r+e]),this.drawer.pushIndices(0,this.getIndieces([0,1,3,1,2,3],this.cound)),this.minX=Math.min(i,this.minX),this.maxX=Math.max(t+i,this.maxX),this.minY=Math.min(r,this.minY),this.maxY=Math.max(e+r,this.maxY),this.cound++},e}(Grix),ImgGrix=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.add=function(t,e,i,r,o){var n=this;return void 0===r&&(r=0),void 0===o&&(o=0),null!=this.texture&&this.texture!=i?Plena.log("You cannot use different texture files in one ImgGrix!"):this.texture=i,i.onLoaded(function(){var t=i.getCoord();n.drawer.pushUV([t.getXMin(),t.getYMin(),t.getXMax(),t.getYMin(),t.getXMax(),t.getYMax(),t.getXMin(),t.getYMax()])}),this.addRect(t,e,r,o),this},e.prototype.fromTexture=function(t,e,i){var r=this;return t.onLoaded(function(){r.add(e?e:t.getWidth(),i?i:t.getHeight(),t),r.populate()}),this},e.prototype.getImg=function(){return this.texture},e.prototype.populate=function(){return t.prototype.populate.call(this),this},e}(TexturedGrix),Grix;!function(t){function e(t,e,r,o){return(new ImgGrix).fromTexture(i(t,e),r,o)}function i(t,e){if(t.getCoord)return t;if(t.getBaseImg)return t.getBaseImg();var i=t.canvas;return i||(i=t),Assets.getTexture(i,e)}t.fromTexture=e}(Grix||(Grix={}));var WritableGrix=function(t){function e(e,i){t.call(this,i),this.wX=0,this.wY=0,this.pwX=0,this.pwY=0,this.writable=e,this.texture=e.getImg()}return __extends(e,t),e.prototype.startWrite=function(t){this.color&&(this.oldColor=Plena.getCurrCol(),Plena.setColor(this.color)),this.writable.startWrite(t)},e.prototype.endWrite=function(){this.writable.stopWrite(),this.color&&Plena.setColor(this.oldColor)},e.prototype.moveWirte=function(t,e){this.moveTo(this.wX+t,this.wY+e)},e.prototype.moveWirteTo=function(t,e){this.moveWirteXTo(t),this.moveWirteYTo(e)},e.prototype.moveWirteXTo=function(t){this.wX=t-this.writable.getWidth()*this.pwX,this.writable.x=this.wX},e.prototype.setBackground=function(t){this.color=t},e.prototype.moveWirteYTo=function(t){this.wY=t-this.writable.getHeight()*this.pwY,this.writable.y=this.wY},e.prototype.setPivotWirte=function(t,e){this.pwX=t,this.pwY=e},e.prototype.clean=function(){t.prototype.clean.call(this)},e.prototype.populate=function(){return t.prototype.populate.call(this),this},e}(ImgGrix),Grix;!function(t){function e(t){return new WritableGrix(t).fromTexture(t.getImg())}t.writable=e}(Grix||(Grix={}));var SpriteGrix=function(t){function e(e,i){var r=this;t.call(this,i),this.step=0,this.autoSize=!1,this.imgWidth=0,this.imgHeight=0,this.texture=e,e.onLoaded(function(){e.hasSubImg()?r.activeImg(e.arbImgName()):e.hasAnime()?r.activeAnime(e.arbAnimName()):Plena.log("No sub images or animations found in sprite file!")})}return __extends(e,t),e.prototype.add=function(t,e,i,r){return void 0===i&&(i=0),void 0===r&&(r=0),this.drawer.pushUV([0,0,1,0,1,1,0,1]),this.addRect(t,e,i,r),this},e.prototype.fromSprite=function(){var t=this;return this.texture.onLoaded(function(){t.defaultImg?t.texture.getImg(t.defaultImg):t.texture.getAnim(t.defaultAnime)[0];t.add(1,1),t.autoSize=!0,t.populate()}),this},e.prototype.getImg=function(){return this.texture.getBaseImg()},e.prototype.clean=function(){t.prototype.clean.call(this),this.img=this.defaultImg,this.anime=this.defaultAnime,this.autoSize&&(this.imgWidth=(this.img?this.texture.getImg(this.img):this.texture.getAnim(this.anime)[0]).getWidth(),this.imgHeight=(this.img?this.texture.getImg(this.img):this.texture.getAnim(this.anime)[0]).getHeight())},e.prototype.activeImg=function(t){return this.autoSize&&(this.imgWidth=this.texture.getImg(t).getWidth(),this.imgHeight=this.texture.getImg(t).getHeight()),this.isFinal?this.img=t:this.defaultImg=t,this.anime=null,this.isFinal||(this.defaultAnime=null),this},e.prototype.activeAnime=function(t){return this.autoSize&&(this.imgWidth=this.texture.getAnim(t)[0].getWidth(),this.imgHeight=this.texture.getAnim(t)[0].getHeight()),this.isFinal?this.anime=t:this.defaultAnime=t,this.img=null,this.isFinal||(this.defaultImg=null),this},e.prototype.scaleToSize=function(t,e){var i=t/this.getImgWidth(),r=e/this.getImgHeight();this.scaleTo(i,r)},e.prototype.scaleWidthToSize=function(t){var e=t/this.getImgWidth();this.scaleTo(e,e)},e.prototype.scaleHeightToSize=function(t){var e=t/this.getImgHeight();this.scaleTo(e,e)},e.prototype.getImgWidth=function(){return this.autoSize?this.imgWidth:this.width},e.prototype.getImgHeight=function(){return this.autoSize?this.imgHeight:this.height},e.prototype.getXScale=function(){return this.sXT*(this.autoSize?this.imgWidth:1)},e.prototype.getYScale=function(){return this.sYT*(this.autoSize?this.imgHeight:1)},e.prototype.animeStep=function(t){null==this.anime?Plena.log("Cannot set animation setp, no active animation was set"):this.step=t%this.texture.getAnim(this.anime).length},e.prototype.createGrixc=function(t){var e={transform:t,img:this.img,anime:this.anime,step:this.step};return e},e.prototype.doRender=function(t){var e=t;if(null!=e.anime||null!=e.img){var i=(null==e.anime?this.texture.getImg(e.img):this.texture.getAnim(e.anime)[e.step]).getCoord(),r=i.getXMax()-i.getXMin(),o=i.getYMax()-i.getYMin(),n=[r,0,0,0,0,o,0,0,0,0,1,0,i.getXMin(),i.getYMin(),0,1];this.getShader().getMatHandler().setUVMatrix(n),this.drawer.drawElements(0,this.mode)}else Plena.log("AnimeGrix has no active animation or image! Maybe you fotgot to setup your sprite?")},e.prototype.populate=function(){return t.prototype.populate.call(this),this},e.prototype.end=function(){t.prototype.end.call(this),this.getShader().getMatHandler().setUVMatrix(Matrix4.identity())},e}(TexturedGrix),Grix;!function(t){function e(t){return new SpriteGrix(t).fromSprite()}t.fromSprite=e}(Grix||(Grix={}));var TextGrix=function(t){function e(e,i){t.call(this,e.getMap(),i),this.yOffset=0,this.xOffset=0,this.add(1,1),this.populate(),this.fontMap=e}return __extends(e,t),e.prototype.fontsize=function(t){var e=t/this.fontMap.defaultSize();this.scaleTo(e,e)},e.prototype.offsetY=function(t){this.yOffset=t},e.prototype.offsetX=function(t){this.xOffset=t},e.prototype.storeText=function(t,e,i){void 0===i&&(i=-1)},e.prototype.cleanText=function(t){},e.prototype.drawText=function(t){},e.prototype.text=function(t,e){void 0===e&&(e=-1)},e.prototype.clean=function(){t.prototype.clean.call(this),this.yOffset=0,this.xOffset=0},e.prototype.freeText=function(t,e){void 0===e&&(e=-1);var i=this.xT;this.yT;if(-1!=e)for(var r=t.split(" "),o=0,n=0;n<r.length;n++){var s=r[n];o>0&&o+this.length(s)>e?(o=0,this.moveXTo(i),this.move(0,(this.fontMap.getDim("a")[1]+this.yOffset)*this.sYT),o+=this.do_text(s+" ")):o+=this.do_text(s+" ")}else this.do_text(t)},e.prototype.length=function(t){for(var e=0,i=0;i<t.length;i++){var r=t.charAt(i);e+=this.fontMap.getDim(r)[0]*this.sXT+this.xOffset}return e},e.prototype.textSplit=function(t,e,i){for(var r=[],o=t.split(" "),n="",s=0;s<o.length;s++)if(0==n.length)n=o[s];else{var a=n+" "+o[s];i.measureText(a).width>e?(r.push(n),n=o[s]):n=a}return n.length>0&&r.push(n),r},e.prototype.do_text=function(t){for(var e=this.sXT,i=this.sYT,r=0,o=0;o<t.length;o++){var n=t.charAt(o);if(" "==n)this.move(this.fontMap.spacing()*e+this.xOffset,0),r+=this.fontMap.spacing()*e+this.xOffset;else{var s=this.fontMap.getDim(n),a=s[1],u=s[0];this.activeImg(n),this.scaleToSize(u*e,a*i),this.render(),this.move(u*e+this.xOffset,0),r+=u*e+this.xOffset}}return this.scaleTo(e,i),r},e}(SpriteGrix),Grix;!function(t){function e(e,i,r,o,n,s){return void 0===r&&(r=Assets.LETTERS),void 0===o&&(o=-1),void 0===n&&(n=0),t.fromTexture(Assets.mkTextImg(e,i,r,o,n,s))}function i(t){return new TextGrix(t)}t.text=e,t.fromFontMap=i}(Grix||(Grix={}));var ShapeGrix=function(t){function e(){t.apply(this,arguments),this.minX=Math.min(),this.minY=Math.min(),this.maxX=Math.max(),this.maxY=Math.max(),this.colorDefault=Color.Gray.BLACK,this.indiece=0,this.drawModes=[gl.TRIANGLES]}return __extends(e,t),e.prototype.populate=function(){return this.height=Math.abs(this.maxY-this.minY),this.width=Math.abs(this.maxX-this.minX),t.prototype.populate.call(this),this},e.prototype.getShader=function(){return this.customeShader?this.customeShader:Shader.getShader(Shader.COLOR)},e.prototype.setColor=function(t){return this.isFinal?this.color=t:this.colorDefault=t,this},e.prototype.clean=function(){t.prototype.clean.call(this),this.color=this.colorDefault},e.prototype.setMaxMin=function(t,e,i,r){this.setMaxMinX(t,e),this.setMaxMinY(i,r)},e.prototype.setMaxMinX=function(t,e){this.minX=Math.min(this.minX,t),this.maxX=Math.max(this.maxX,e)},e.prototype.setMaxMinY=function(t,e){this.minY=Math.min(this.minY,t),this.maxY=Math.max(this.maxY,e)},e.prototype.point=function(t,e,i){return void 0===i&&(i=0),this.drawer.pushVerts([t,e]),this.drawer.pushIndices(i,[this.indiece]),this.indiece+=1,this.setMaxMin(t,t,e,e),this},e.prototype.line=function(t,e,i,r,o){return void 0===o&&(o=0),this.drawer.pushVerts([t,e,i,r]),this.drawer.pushIndices(o,[this.indiece,this.indiece+1]),this.indiece+=2,this.setMaxMin(t,i,e,r),this},e.prototype.quad=function(t,e,i,r,o){void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=0),(0>i||0>r)&&Plena.log("A negative value for x or y was passed to a grix, grix might not behave as sespected during transformation before drawing, try to make this positive. The positioning is not meant for presise positioning in a world, only for relative location to other shapes in this grix, use move transformation in grix for presise transformation in your world");var n=this.indiece;return this.drawer.pushVerts([i,r,i+t,r,i+t,r+e,i,r+e]),this.drawer.pushIndices(o,[n,n+1,n+2,n+2,n+3,n+0]),this.setMaxMin(i,i+t,r,r+e),this.indiece+=4,this},e.prototype.ellipse=function(t,e,i,r,o,n,s){void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===n&&(n=!0),void 0===s&&(s=35);var a=n?[i+t,r+e]:[],u=n?[0]:[];n&&(this.indiece+=1);for(var h=0;s+1>h;h++){var l=h*(2*Math.PI/s);a.push(i+t+Math.cos(l)*t),a.push(r+e+Math.sin(l)*e),u.push(h+this.indiece)}return this.drawer.pushVerts(a),this.drawer.pushIndices(o,u),this.setMaxMin(i-t,i+t,r-t,r+t),this.indiece+=s+1,this},e.prototype.circle=function(t,e,i,r,o,n){return void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=!0),void 0===n&&(n=35),this.ellipse(t,t,e,i,r,o,n)},e.prototype.polygon=function(t,e,i,r,o,n){return void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===n&&(n=!0),this.circle(t,i,r,o,n,e)},e.prototype.drawmode=function(t,e){return void 0===e&&(e=0),this.drawModes[e]=t,this},e.prototype.drawmodes=function(t){for(var e in t)this.drawModes[e]=t[e];return this},e.prototype.add=function(t,e,i){void 0===i&&(i=0),0!=(1&t.length)&&Plena.log("Uneven vertex coords supplied to drawer!");for(var r=0;r<t.length;r++)0==(1&r)?this.setMaxMinX(t[r],t[r]):this.setMaxMinY(t[r],t[r]);if(this.drawer.pushVerts(t),e)this.drawer.pushIndices(i,e);else{for(var o=[],n=t.length/2;n>0;n--)o.push(this.indiece+(t.length/2-n));this.indiece+=t.length/2,this.drawer.pushIndices(i,o)}return this},e.prototype.drawOffset=function(){},e.prototype.createGrixc=function(t){var e={transform:t,color:this.color.vec()};return e},e.prototype.doRender=function(t){var e=t;this.getShader().setVec4(Shader.Uniforms.COLOR,e.color);for(var i in this.drawModes)this.drawer.drawElements(i,this.drawModes[i])},e}(Grix),DrawModes;!function(t){t.POINTS=0,t.LINES=1,t.LINES_LOOP=2,t.LINES_STRIP=3,t.TRIANGLES=4,t.TRIANGLE_STRIP=5,t.TRIANGLE_FAN=6}(DrawModes||(DrawModes={}));var Grix;!function(t){function e(){return new ShapeGrix}t.shape=e}(Grix||(Grix={}));var Mouse;!function(t){function e(){document.body.onmouseup=n,document.body.onmousedown=s,document.onmousemove=o}function i(t){document.onmousemove=t}function r(t,e){document.body.onmouseup=e,document.body.onmousedown=t}function o(t){_=t.clientX,T=t.clientY}function n(t){var e=t.button;a(e,!1),m(v,e,t)}function s(t){var e=t.button;d(e)||m(R,e,t),a(e,!0)}function a(t,e){M[t]=e}function u(){document.body.style.cursor="none"}function h(){document.body.style.cursor="auto"}function l(t){return t.mapX(_,!0)}function p(t){return t.mapY(T,!0)}function f(){return _}function c(){return T}function d(t){return M[t]}function g(t){w=t}function m(t,e,i){if(t.contains(e))for(var r=t.itterator(e),o=0;o<r.length;o++){var n=r[o];n(i)}for(var s=t.itterator(-1),a=0;a<s.length;a++){var n=s[a];n(i)}}function E(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];y(v,t,e)}function A(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];y(R,t,e)}function y(t,e,i){if(0==i.length)t.put(-1,e);else for(var r=0;r<i.length;r++){var o=i[r];t.put(o,e)}}var R=new DeepTreeMap(NUMBER_COMPARE),v=new DeepTreeMap(NUMBER_COMPARE),w=!0;t.LEFT=0,t.RIGHT=1,t.MIDDLE=2;var _,T,M=[];t.enable=e,t.customListenPos=i,t.customListen=r,t.hide=u,t.show=h,t.getX=l,t.getY=p,t.getScreenX=f,t.getScreenY=c,t.isDown=d,t.browserControll=g,t.addReleasedEvent=E,t.addPressedEvent=A}(Mouse||(Mouse={}));var Keyboard;!function(t){function e(t,e){document.onkeydown=t,document.onkeyup=e}function i(t){g=t}function r(){e(o,n)}function o(t){var e=t.keyCode;return a(e)||s(c,e,t),u(e,!0),g}function n(t){var e=t.keyCode;u(e,!1),s(d,e,t)}function s(t,e,i){if(t.contains(e))for(var r=t.itterator(e),o=0;o<r.length;o++){var n=r[o];n(i)}for(var s=t.itterator(-1),a=0;a<s.length;a++){var n=s[a];n(i)}}function a(t){return f[t]}function u(t,e){f[t]=e}function h(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];p(d,t,e)}function l(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];p(c,t,e)}function p(t,e,i){if(0==i.length)t.put(-1,e);else for(var r=0;r<i.length;r++){var o=i[r];t.put(o,e)}}var f=[],c=new DeepTreeMap(NUMBER_COMPARE),d=new DeepTreeMap(NUMBER_COMPARE),g=!0;t.KEY_BACKSPACE=8,t.KEY_TAB=9,t.KEY_ENTER=13,t.KEY_SHIFT=16,t.KEY_CTRL=17,t.KEY_ALT=18,t.KEY_BREAK=19,t.KEY_CAPS_LOCK=20,t.KEY_ESCAPE=27,t.KEY_SPACE=32,t.KEY_PAGE_UP=33,t.KEY_PAGE_DOWN=34,t.KEY_END=35,t.KEY_HOME=36,t.KEY_LEFT=37,t.KEY_UP=38,t.KEY_RIGHT=39,t.KEY_DOWN=40,t.KEY_INSERT=45,t.KEY_DELETE=46,t.KEY_0=48,t.KEY_1=49,t.KEY_2=50,t.KEY_3=51,t.KEY_4=52,t.KEY_5=53,t.KEY_6=54,t.KEY_7=55,t.KEY_8=56,t.KEY_9=57,t.KEY_A=65,t.KEY_B=66,t.KEY_C=67,t.KEY_D=68,t.KEY_E=69,t.KEY_F=70,t.KEY_G=71,t.KEY_H=72,t.KEY_I=73,t.KEY_J=74,t.KEY_K=75,t.KEY_L=76,t.KEY_M=77,t.KEY_N=78,t.KEY_O=79,t.KEY_P=80,t.KEY_Q=81,t.KEY_R=82,t.KEY_S=83,t.KEY_T=84,t.KEY_U=85,t.KEY_V=86,t.KEY_W=87,t.KEY_X=88,t.KEY_Y=89,t.KEY_Z=90,t.KEY_WINDOWS_LEFT=91,t.KEY_WINDOWS_RIGHT=92,t.KEY_SELECT=93,t.KEY_NUMPAD_0=96,t.KEY_NUMPAD_1=97,t.KEY_NUMPAD_2=98,t.KEY_NUMPAD_3=99,t.KEY_NUMPAD_4=100,t.KEY_NUMPAD_5=101,t.KEY_NUMPAD_6=102,t.KEY_NUMPAD_7=103,t.KEY_NUMPAD_8=104,t.KEY_NUMPAD_9=105,t.KEY_MULTIPLY=106,t.KEY_ADD=107,t.KEY_SUBSTRACT=108,t.KEY_POINT=109,t.KEY_DECIMAL_POINT=110,t.DEVIDE=111,t.KEY_F1=112,t.KEY_F2=113,t.KEY_F3=114,t.KEY_F4=115,t.KEY_F5=116,t.KEY_F6=117,t.KEY_F7=118,t.KEY_F8=119,t.KEY_F9=120,t.KEY_F10=121,t.KEY_F11=122,t.KEY_F12=123,t.KEY_NUM_LOCK=144,t.KEY_SCROLL_LOCK=145,t.KEY_SEMI_COLON=186,t.KEY_EQUAL_SIGN=187,t.KEY_COMMA=188,t.KEY_DASH=189,t.KEY_PERIOD=190,t.KEY_SLASH_FORWARD=191,t.KEY_GRAVE_ACCENT=192,t.KEY_BRACKET_OPEN=219,t.KEY_SLASH_BACK=220,t.KEY_BRACKET_CLOSE=221,t.KEY_QUOTE_SINGLE=222,t.customListen=e,t.browserControll=i,t.enable=r,t.isDown=a,t.addReleasedEvent=h,t.addPressedEvent=l}(Keyboard||(Keyboard={}));var Vector=function(){function t(){}return t.clean=function(t){for(var e=[],i=0;t>i;i++)e[i]=0;return e},t.create=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];for(var i=[],r=0;r<t.length;r++)i[r]=t[r];return i},t.dot=function(t,e){for(var i=0,r=0;r<t.length;r++)i+=t[r]*e[r];return i},t.magnitude=function(e){return Math.sqrt(t.dot(e,e))},t.angle=function(e,i){return Math.acos(t.dot(e,i)/(t.magnitude(e)*t.magnitude(i)))},t}(),Vector2=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.clean=function(){return[0,0]},e.create=function(t,e){return[t,e]},e.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},e}(Vector),Vector3=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.clean=function(){return[0,0,0]},e.create=function(t,e,i){return[t,e,i]},e.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},e}(Vector),Vector4=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.clean=function(){return[0,0,0,0]},e.create=function(t,e,i,r){return[t,e,i,r]},e.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},e}(Vector),Matrix=function(){function t(){}return t.clean=function(t){return Vector.clean(t*t)},t.identity=function(t){for(var e=[],i=0;t*t>i;i++)e[i]=Math.floor(i/t)-i%t==0?1:0;return e},t.copy=function(t){return t.slice()},t.getRow=function(e,i){for(var r=t.size(e),o=[],n=0;r>n;n++)o[n]=e[i+n*r];return o},t.getColom=function(e,i){for(var r=t.size(e),o=[],n=0;r>n;n++)o[n]=e[i*r+n];return o},t.getValue=function(e,i,r){var o=t.size(e);return e[i+r*o]},t.setRow=function(e,i,r){for(var o=t.size(e),n=0;o>n;n++)e[i+n*o]=r[n];return e},t.setColom=function(e,i,r){for(var o=t.size(e),n=0;o>n;n++)e[i*o+n]=r[n];return e},t.setvalue=function(e,i,r,o){var n=t.size(e);return e[i+r*n]=o,e},t.size=function(t){return Math.sqrt(t.length)},t.getTranspose=function(e){for(var i=t.size(e),r=t.clean(i),o=0;i>o;o++)t.setColom(r,o,t.getRow(e,o));return r},t}(),Matrix4=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.identity=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},e.mul=function(t,e){return[t[0]*e[0]+t[4]*e[1]+t[8]*e[2]+t[12]*e[3],t[1]*e[0]+t[5]*e[1]+t[9]*e[2]+t[13]*e[3],t[2]*e[0]+t[6]*e[1]+t[10]*e[2]+t[14]*e[3],t[3]*e[0]+t[7]*e[1]+t[11]*e[2]+t[15]*e[3],t[0]*e[4]+t[4]*e[5]+t[8]*e[6]+t[12]*e[7],t[1]*e[4]+t[5]*e[5]+t[9]*e[6]+t[13]*e[7],t[2]*e[4]+t[6]*e[5]+t[10]*e[6]+t[14]*e[7],t[3]*e[4]+t[7]*e[5]+t[11]*e[6]+t[15]*e[7],t[0]*e[8]+t[4]*e[9]+t[8]*e[10]+t[12]*e[11],t[1]*e[8]+t[5]*e[9]+t[9]*e[10]+t[13]*e[11],t[2]*e[8]+t[6]*e[9]+t[10]*e[10]+t[14]*e[11],t[3]*e[8]+t[7]*e[9]+t[11]*e[10]+t[15]*e[11],t[0]*e[12]+t[4]*e[13]+t[8]*e[14]+t[12]*e[15],t[1]*e[12]+t[5]*e[13]+t[9]*e[14]+t[13]*e[15],t[2]*e[12]+t[6]*e[13]+t[10]*e[14]+t[14]*e[15],t[3]*e[12]+t[7]*e[13]+t[11]*e[14]+t[15]*e[15]]},e.translate=function(t,i,r){if("number"==typeof r){var o=i,n=r,s=t,a=Vector4.create(s[0]*o+s[4]*n+s[12],s[1]*o+s[5]*n+s[13],s[2]*o+s[6]*n+s[14],s[3]*o+s[7]*n+s[15]);return e.setColom(s,3,a)}var o=t,n=i;return[1,0,0,0,0,1,0,0,0,0,1,0,o,n,0,1]},e.scale=function(t,i,r){if("number"==typeof r){var o=i,n=r,s=t,a=Vector4.create(s[0]*o,s[1]*o,s[2]*o,s[3]*o),u=Vector4.create(s[4]*n,s[5]*n,s[6]*n,s[7]*n);return e.setColom(s,0,a),e.setColom(s,1,u),s}var o=t,n=i;return[o,0,0,0,0,n,0,0,0,0,1,0,0,0,0,1]},e.rotate=function(t,i){if("number"==typeof i){var r=i,o=t,n=Vector4.create(o[0]*Math.cos(r)+o[4]*Math.sin(r),o[1]*Math.cos(r)+o[5]*Math.sin(r),o[2]*Math.cos(r)+o[6]*Math.sin(r),o[3]*Math.cos(r)+o[7]*Math.sin(r)),s=Vector4.create(o[0]*-Math.sin(r)+o[4]*Math.cos(r),o[1]*-Math.sin(r)+o[5]*Math.cos(r),o[2]*-Math.sin(r)+o[6]*Math.cos(r),o[3]*-Math.sin(r)+o[7]*Math.cos(r));return e.setColom(o,0,n),e.setColom(o,1,s),o}var r=t;return[Math.cos(r),Math.sin(r),0,0,-Math.sin(r),Math.cos(r),0,0,0,0,1,0,0,0,0,1]},e.ortho=function(t,e,i,r){return[2/(e-t),0,0,0,0,2/(r-i),0,0,0,0,1,0,-(e+t)/(e-t),-(r+i)/(r-i),-0/-2,1]},e}(Matrix),Matrix3=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.identity=function(){return[1,0,0,0,1,0,0,0,1]},e.mul=function(t,e){return[t[0]*e[0]+t[3]*e[1]+t[6]*e[2],t[1]*e[0]+t[4]*e[1]+t[7]*e[2],t[2]*e[0]+t[5]*e[1]+t[8]*e[2],t[0]*e[3]+t[3]*e[4]+t[6]*e[5],t[1]*e[3]+t[4]*e[4]+t[7]*e[5],t[2]*e[3]+t[5]*e[4]+t[8]*e[5],t[0]*e[6]+t[3]*e[7]+t[6]*e[8],t[1]*e[6]+t[4]*e[7]+t[7]*e[8],t[2]*e[6]+t[5]*e[7]+t[8]*e[8]]},e}(Matrix),Matrix2=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.identity=function(){return[1,0,0,1]},e.mul=function(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3]]},e}(Matrix),MMath;!function(t){function e(t){u=t}function i(t,e){void 0===t&&(t=0),void 0===e&&(e=1),u=(9301*u+49297)%233280;var i=u/233280;return t+i*(e-t)}function r(t){return t*h}function o(t){return t*l}function n(t,e){return(t%e+e)%e}function s(t,e){return Math.log(e)/Math.log(t)}function a(t){return 0==t?!1:0==(t&t-1)}var u=0,h=2*Math.PI/360,l=360/(2*Math.PI);t.setRandomSeed=e,t.random=i,t.toRad=r,t.toDeg=o,t.mod=n,t.logN=s,t.isPowerOf2=a}(MMath||(MMath={}));var AColor=function(){function t(t,e,i,r){"number"==typeof r?(this.theColor=new Color(t,e,i),this.alpha=r):(this.theColor=t,this.alpha=i)}return t.prototype.color=function(){return this.theColor},t.prototype.a=function(){return this.a},t.prototype.r=function(){return this.theColor.r()},t.prototype.b=function(){return this.theColor.b()},t.prototype.g=function(){return this.theColor.g()},t.prototype.style=function(){return this.theColor.style(this.alpha)},t.prototype.vec=function(){return this.theColor.vec(this.alpha)},t.prototype.hex=function(){return this.theColor.hex()},t.prototype.clearcolor=function(){var t=this.vec();gl.clearColor(t[0],t[1],t[2],t[3])},t}(),Color=function(){function t(e,i,r){if("number"==typeof r)this.rV=e,this.gV=i,this.bV=r;else{var o;o="string"==typeof e?t.toRGB(e):e,this.rV=255*o[0],this.bV=255*o[1],this.gV=255*o[2]}}return t.prototype.r=function(){return this.rV},t.prototype.b=function(){return this.bV},t.prototype.g=function(){return this.gV},t.prototype.style=function(t){return void 0===t&&(t=1),"rgba("+this.rV+", "+this.gV+", "+this.bV+", "+t+")"},t.prototype.vec=function(t){return void 0===t&&(t=1),[this.rV/255,this.gV/255,this.bV/255,t]},t.prototype.hex=function(){return t.toHex(this.rV,this.gV,this.bV)},t.prototype.clearcolor=function(){var t=this.vec();gl.clearColor(t[0],t[1],t[2],t[3])},t.toRGB=function(t){var e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;t=t.replace(e,function(t,e,i,r){return e+e+i+i+r+r});var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return i?[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16)]:null},t.componentToHex=function(t){var e=t.toString(16);return 1==e.length?"0"+e:e},t.toHex=function(e,i,r){return"#"+t.componentToHex(e)+t.componentToHex(i)+t.componentToHex(r)},t}(),Color;!function(t){var e;!function(e){function i(t){return void 0===t&&(t=1),new AColor(e.PINK,t)}function r(t){return void 0===t&&(t=1),new AColor(e.PINK_LIGHT,t)}function o(t){return void 0===t&&(t=1),new AColor(e.PINK_HOT,t)}function n(t){return void 0===t&&(t=1),new AColor(e.PINK_DEEP,t)}function s(t){return void 0===t&&(t=1),new AColor(e.VIOLET_RED_PALE,t)}function a(t){return void 0===t&&(t=1),new AColor(e.VIOLET_RED_MEDIUM,t)}e.PINK=new t(255,192,203),e.pink=i,e.PINK_LIGHT=new t(255,182,193),e.pinkLight=r,e.PINK_HOT=new t(255,105,180),e.pinkHot=o,e.PINK_DEEP=new t(255,20,147),e.pinkDeep=n,e.VIOLET_RED_PALE=new t(219,112,147),e.violetRedPale=s,e.VIOLET_RED_MEDIUM=new t(199,21,133),e.violetRedMedium=a}(e=t.Pink||(t.Pink={}));var i;!function(e){function i(t){return void 0===t&&(t=1),new AColor(e.SALMON_LIGHT,t)}function r(t){return void 0===t&&(t=1),new AColor(e.SALMON,t)}function o(t){return void 0===t&&(t=1),new AColor(e.SALMON_DARK,t)}function n(t){return void 0===t&&(t=1),new AColor(e.CORAL_LIGHT,t)}function s(t){return void 0===t&&(t=1),new AColor(e.RED_INDIAN,t)}function a(t){return void 0===t&&(t=1),new AColor(e.CRIMSON,t)}function u(t){return void 0===t&&(t=1),new AColor(e.FIREBRIK,t)}function h(t){return void 0===t&&(t=1),new AColor(e.RED_DARK,t)}function l(t){return void 0===t&&(t=1),new AColor(e.RED,t)}e.SALMON_LIGHT=new t(255,160,122),e.salmonLight=i,e.SALMON=new t(250,128,114),e.salmon=r,e.SALMON_DARK=new t(233,150,122),e.salmonDark=o,e.CORAL_LIGHT=new t(240,128,128),e.colalLight=n,e.RED_INDIAN=new t(205,92,92),e.redIndian=s,e.CRIMSON=new t(220,20,60),e.crimson=a,e.FIREBRIK=new t(178,34,34),e.firebrik=u,e.RED_DARK=new t(139,0,0),e.redDark=h,e.RED=new t(255,0,0),e.red=l}(i=t.Red||(t.Red={}));var r;!function(e){function i(t){return void 0===t&&(t=1),new AColor(e.ORANGE_RED,t)}function r(t){return void 0===t&&(t=1),new AColor(e.TOMATO,t)}function o(t){return void 0===t&&(t=1),new AColor(e.CORAL,t)}function n(t){return void 0===t&&(t=1),new AColor(e.ORANGE_DARK,t)}function s(t){return void 0===t&&(t=1),new AColor(e.ORANGE,t)}e.ORANGE_RED=new t(255,69,0),e.orangeRed=i,e.TOMATO=new t(255,99,71),e.tomato=r,e.CORAL=new t(255,127,80),e.coral=o,e.ORANGE_DARK=new t(255,140,0),e.orangeDark=n,e.ORANGE=new t(255,165,0),e.orange=s}(r=t.Orange||(t.Orange={}));var o;!function(e){function i(t){return void 0===t&&(t=1),new AColor(e.YELLOW,t)}function r(t){return void 0===t&&(t=1),new AColor(e.YELLOW_LIGHT,t)}function o(t){return void 0===t&&(t=1),new AColor(e.LEMON_CHIFFON,t)}function n(t){return void 0===t&&(t=1),new AColor(e.GOLDENROD_YELLO_LIGHT,t)}function s(t){return void 0===t&&(t=1),new AColor(e.PAPAYA_WHIP,t)}function a(t){return void 0===t&&(t=1),new AColor(e.MOCCASIN,t)}function u(t){return void 0===t&&(t=1),new AColor(e.PEACH_PUFF,t)}function h(t){return void 0===t&&(t=1),new AColor(e.GOLDENROD_PALE,t)}function l(t){return void 0===t&&(t=1),new AColor(e.KHAKI,t)}function p(t){return void 0===t&&(t=1),new AColor(e.KHAKI_DARK,t)}function f(t){return void 0===t&&(t=1),new AColor(e.GOLD,t)}e.YELLOW=new t(255,255,0),e.yellow=i,e.YELLOW_LIGHT=new t(255,255,224),e.yellowLight=r,e.LEMON_CHIFFON=new t(255,250,205),e.lemonChiffon=o,e.GOLDENROD_YELLO_LIGHT=new t(250,250,210),e.goldenrodYellowLight=n,e.PAPAYA_WHIP=new t(255,239,213),e.papayaWhip=s,e.MOCCASIN=new t(255,228,181),e.moccasin=a,e.PEACH_PUFF=new t(255,218,185),e.peachPuff=u,e.GOLDENROD_PALE=new t(238,232,170),e.goldenrodPale=h,e.KHAKI=new t(240,230,140),e.khaki=l,e.KHAKI_DARK=new t(189,183,107),e.khakiDark=p,e.GOLD=new t(255,215,0),e.gold=f}(o=t.Yellow||(t.Yellow={}));var n;!function(e){function i(t){return void 0===t&&(t=1),new AColor(e.CORNSILK,t)}function r(t){return void 0===t&&(t=1),new AColor(e.ALMOND_BLANCHED,t)}function o(t){return void 0===t&&(t=1),new AColor(e.BISQUE,t)}function n(t){return void 0===t&&(t=1),new AColor(e.NAVAJO_WHITE,t)}function s(t){return void 0===t&&(t=1),new AColor(e.WHEAT,t)}function a(t){return void 0===t&&(t=1),new AColor(e.WOOD_BLURY,t)}function u(t){return void 0===t&&(t=1),new AColor(e.TAN,t)}function h(t){return void 0===t&&(t=1),new AColor(e.BROWN_ROSY,t)}function l(t){return void 0===t&&(t=1),new AColor(e.BROWN_SANDY,t)}function p(t){return void 0===t&&(t=1),new AColor(e.GOLDENROD,t)}function f(t){return void 0===t&&(t=1),new AColor(e.GOLDENROD_DARK,t)}function c(t){return void 0===t&&(t=1),new AColor(e.PERU,t)}function d(t){return void 0===t&&(t=1),new AColor(e.CHOCOLATE,t)}function g(t){return void 0===t&&(t=1),new AColor(e.BROWN_SADDLE,t)}function m(t){return void 0===t&&(t=1),new AColor(e.SIENNA,t)}function E(t){return void 0===t&&(t=1),new AColor(e.BROWN,t)}function A(t){return void 0===t&&(t=1),new AColor(e.MAROON,t)}e.CORNSILK=new t(255,248,220),e.ornSilk=i,e.ALMOND_BLANCHED=new t(255,235,205),e.almondBlanched=r,e.BISQUE=new t(255,228,196),e.bisque=o,e.NAVAJO_WHITE=new t(255,222,173),e.navajoWhite=n,e.WHEAT=new t(245,222,179),e.wheat=s,e.WOOD_BLURY=new t(222,184,135),e.woodBlury=a,e.TAN=new t(210,180,140),e.tan=u,e.BROWN_ROSY=new t(188,143,143),e.brownRosy=h,e.BROWN_SANDY=new t(244,164,96),e.brownSandy=l,e.GOLDENROD=new t(218,165,32),e.goldenrod=p,e.GOLDENROD_DARK=new t(184,134,11),e.goldenrodDark=f,e.PERU=new t(205,133,63),e.peru=c,e.CHOCOLATE=new t(210,105,30),e.chocolate=d,e.BROWN_SADDLE=new t(139,69,19),e.brownSaddle=g,e.SIENNA=new t(160,82,45),e.sienna=m,e.BROWN=new t(165,42,42),e.brown=E,e.MAROON=new t(128,0,0),e.maroon=A}(n=t.Brown||(t.Brown={}));var s;!function(e){function i(t){return void 0===t&&(t=1),new AColor(e.OLIVE_GREEN_DARK,t)}function r(t){return void 0===t&&(t=1),new AColor(e.OLIVE,t)}function o(t){return void 0===t&&(t=1),new AColor(e.OLIVE_DRAB,t)}function n(t){return void 0===t&&(t=1),new AColor(e.YELLOW_GREEN,t)}function s(t){return void 0===t&&(t=1),new AColor(e.LIME_GREEN,t)}function a(t){return void 0===t&&(t=1),new AColor(e.LIME,t)}function u(t){return void 0===t&&(t=1),new AColor(e.GREEN_LAWN,t)}function h(t){return void 0===t&&(t=1),new AColor(e.CHARTEUSE,t)}function l(t){return void 0===t&&(t=1),new AColor(e.GREEN_YELLOW,t)}function p(t){return void 0===t&&(t=1),new AColor(e.GREEN_SPRING,t)}function f(t){return void 0===t&&(t=1),new AColor(e.GREEN_SPRING_MEDIUM,t)}function c(t){return void 0===t&&(t=1),new AColor(e.GREEN_LIGHT,t)}function d(t){return void 0===t&&(t=1),new AColor(e.GREEN_PALE,t)}function g(t){return void 0===t&&(t=1),new AColor(e.GREEN_SEA_DARK,t)}function m(t){return void 0===t&&(t=1),new AColor(e.AQUAMARINE_MEDIUM,t)}function E(t){return void 0===t&&(t=1),new AColor(e.GREEN_SEA_MEDIUM,t)}function A(t){return void 0===t&&(t=1),new AColor(e.GREEN_SEA,t)}function y(t){return void 0===t&&(t=1),new AColor(e.GREEN_FORREST,t)}function R(t){return void 0===t&&(t=1),new AColor(e.GREEN,t)}function v(t){return void 0===t&&(t=1),new AColor(e.GREEN_DARK,t)}e.OLIVE_GREEN_DARK=new t(85,107,47),e.oliveGreenDark=i,e.OLIVE=new t(128,128,0),e.olive=r,e.OLIVE_DRAB=new t(107,142,35),e.oliveDrab=o,e.YELLOW_GREEN=new t(154,205,50),e.yellowGreen=n,e.LIME_GREEN=new t(50,205,50),e.limeGreen=s,e.LIME=new t(0,255,0),e.lime=a,e.GREEN_LAWN=new t(124,252,0),e.greenlawn=u,e.CHARTEUSE=new t(127,255,0),e.charteuse=h,e.GREEN_YELLOW=new t(173,255,47),e.greenYellow=l,e.GREEN_SPRING=new t(0,255,127),e.greenSpring=p,e.GREEN_SPRING_MEDIUM=new t(0,250,154),e.greenSpringMedium=f,e.GREEN_LIGHT=new t(144,238,144),e.greenLight=c,e.GREEN_PALE=new t(152,251,152),e.greenPale=d,e.GREEN_SEA_DARK=new t(143,188,143),e.greenSeaDark=g,e.AQUAMARINE_MEDIUM=new t(102,205,170),e.aquamarineMedium=m,e.GREEN_SEA_MEDIUM=new t(60,179,113),e.greenSeaMedium=E,e.GREEN_SEA=new t(46,139,87),e.greenSea=A,e.GREEN_FORREST=new t(34,139,34),e.greenForrest=y,e.GREEN=new t(0,128,0),e.green=R,e.GREEN_DARK=new t(0,100,0),e.greenDark=v}(s=t.Green||(t.Green={}));var a;!function(e){function i(t){return void 0===t&&(t=1),new AColor(e.AQUA,t)}function r(t){return void 0===t&&(t=1),new AColor(e.CYAN,t)}function o(t){return void 0===t&&(t=1),new AColor(e.CYAN_LIGHT,t)}function n(t){return void 0===t&&(t=1),new AColor(e.TURQUOISE_PALE,t)}function s(t){return void 0===t&&(t=1),new AColor(e.AQUARMARINE,t)}function a(t){return void 0===t&&(t=1),new AColor(e.TURQUOISE,t)}function u(t){return void 0===t&&(t=1),new AColor(e.TURQUOISE_MEDIUM,t)}function h(t){return void 0===t&&(t=1),new AColor(e.TURQUOISE_DARK,t)}function l(t){return void 0===t&&(t=1),new AColor(e.GREEN_SEA_LIGHT,t)}function p(t){return void 0===t&&(t=1),new AColor(e.BLUE_CADET,t)}function f(t){return void 0===t&&(t=1),new AColor(e.CYAN_DARK,t)}function c(t){return void 0===t&&(t=1),new AColor(e.TEAL,t)}e.AQUA=new t(0,255,255),e.aqua=i,e.CYAN=new t(0,255,255),e.cyan=r,e.CYAN_LIGHT=new t(224,255,255),e.cyanLight=o,e.TURQUOISE_PALE=new t(175,238,238),e.turquoisePale=n,e.AQUARMARINE=new t(127,255,212),e.aquamarine=s,e.TURQUOISE=new t(64,224,208),e.turquoise=a,e.TURQUOISE_MEDIUM=new t(72,209,204),e.turquoiseMedium=u,e.TURQUOISE_DARK=new t(0,206,209),e.turquoiseDark=h,e.GREEN_SEA_LIGHT=new t(32,178,170),e.greenSeaLight=l,e.BLUE_CADET=new t(95,158,160),e.blueCadet=p,e.CYAN_DARK=new t(0,139,139),e.cyanDark=f,e.TEAL=new t(0,128,128),e.teal=c;
}(a=t.Cyan||(t.Cyan={}));var u;!function(e){function i(t){return void 0===t&&(t=1),new AColor(e.BLUE_STEEL_LIGHT,t)}function r(t){return void 0===t&&(t=1),new AColor(e.BLUE_POWDER,t)}function o(t){return void 0===t&&(t=1),new AColor(e.BLUE_LIGHT,t)}function n(t){return void 0===t&&(t=1),new AColor(e.BLUE_SKY,t)}function s(t){return void 0===t&&(t=1),new AColor(e.BLUE_SKY_LIGHT,t)}function a(t){return void 0===t&&(t=1),new AColor(e.BLUE_SKY_DEEP,t)}function u(t){return void 0===t&&(t=1),new AColor(e.BLUE_DODGER,t)}function h(t){return void 0===t&&(t=1),new AColor(e.BLUE_CORNFLOWER,t)}function l(t){return void 0===t&&(t=1),new AColor(e.BLUE_STEEL,t)}function p(t){return void 0===t&&(t=1),new AColor(e.BLUE_ROYAL,t)}function f(t){return void 0===t&&(t=1),new AColor(e.BLUE,t)}function c(t){return void 0===t&&(t=1),new AColor(e.BLUE_MEDIUM,t)}function d(t){return void 0===t&&(t=1),new AColor(e.BLUE_DARK,t)}function g(t){return void 0===t&&(t=1),new AColor(e.NAVY,t)}function m(t){return void 0===t&&(t=1),new AColor(e.BLUE_MIDNIGHT,t)}e.BLUE_STEEL_LIGHT=new t(176,196,222),e.blueSteelLight=i,e.BLUE_POWDER=new t(176,224,230),e.bluePowder=r,e.BLUE_LIGHT=new t(173,216,230),e.blueLight=o,e.BLUE_SKY=new t(135,206,235),e.blueSky=n,e.BLUE_SKY_LIGHT=new t(135,206,250),e.blueSkyLight=s,e.BLUE_SKY_DEEP=new t(0,191,255),e.blueSkyDeep=a,e.BLUE_DODGER=new t(30,144,255),e.blueDodger=u,e.BLUE_CORNFLOWER=new t(100,149,237),e.blueCornflower=h,e.BLUE_STEEL=new t(70,130,180),e.blueSteel=l,e.BLUE_ROYAL=new t(65,105,225),e.blueRoyal=p,e.BLUE=new t(0,0,255),e.blue=f,e.BLUE_MEDIUM=new t(0,0,205),e.blueMedium=c,e.BLUE_DARK=new t(0,0,139),e.blueDark=d,e.NAVY=new t(0,0,128),e.navy=g,e.BLUE_MIDNIGHT=new t(25,25,112),e.blueMidnight=m}(u=t.Blue||(t.Blue={}));var h;!function(e){function i(t){return void 0===t&&(t=1),new AColor(e.LAVENDAR,t)}function r(t){return void 0===t&&(t=1),new AColor(e.THISTLE,t)}function o(t){return void 0===t&&(t=1),new AColor(e.PLUM,t)}function n(t){return void 0===t&&(t=1),new AColor(e.VIOLET,t)}function s(t){return void 0===t&&(t=1),new AColor(e.ORCHID,t)}function a(t){return void 0===t&&(t=1),new AColor(e.FUCHSIA,t)}function u(t){return void 0===t&&(t=1),new AColor(e.MAGENTA,t)}function h(t){return void 0===t&&(t=1),new AColor(e.ORCHID_MEDIUM,t)}function l(t){return void 0===t&&(t=1),new AColor(e.PURPLE_MEDIUM,t)}function p(t){return void 0===t&&(t=1),new AColor(e.VIOLET_BLUE,t)}function f(t){return void 0===t&&(t=1),new AColor(e.VIOLET_DARK,t)}function c(t){return void 0===t&&(t=1),new AColor(e.ORCHID_DARK,t)}function d(t){return void 0===t&&(t=1),new AColor(e.MAGENTA_DARK,t)}function g(t){return void 0===t&&(t=1),new AColor(e.PURPLE,t)}function m(t){return void 0===t&&(t=1),new AColor(e.INDIGO,t)}function E(t){return void 0===t&&(t=1),new AColor(e.BLUE_SLATE_DARK,t)}function A(t){return void 0===t&&(t=1),new AColor(e.PURPLE_REBECCA,t)}function y(t){return void 0===t&&(t=1),new AColor(e.BLUE_SLATE,t)}function R(t){return void 0===t&&(t=1),new AColor(e.BLUE_SLATE_MEDIUM,t)}e.LAVENDAR=new t(230,230,250),e.lavendar=i,e.THISTLE=new t(216,191,216),e.thistle=r,e.PLUM=new t(221,160,221),e.plum=o,e.VIOLET=new t(238,130,238),e.violet=n,e.ORCHID=new t(218,112,214),e.orchid=s,e.FUCHSIA=new t(255,0,255),e.fuchsia=a,e.MAGENTA=new t(255,0,255),e.magenta=u,e.ORCHID_MEDIUM=new t(186,85,211),e.orchidMedium=h,e.PURPLE_MEDIUM=new t(147,112,219),e.purpleMedium=l,e.VIOLET_BLUE=new t(138,43,226),e.violetBlue=p,e.VIOLET_DARK=new t(148,0,211),e.violetDark=f,e.ORCHID_DARK=new t(153,50,204),e.orchidDark=c,e.MAGENTA_DARK=new t(139,0,139),e.magentaDark=d,e.PURPLE=new t(128,0,128),e.purple=g,e.INDIGO=new t(75,0,130),e.indigo=m,e.BLUE_SLATE_DARK=new t(72,61,139),e.blueSlateDark=E,e.PURPLE_REBECCA=new t(102,51,153),e.purpleRebecca=A,e.BLUE_SLATE=new t(106,90,205),e.blueSlate=y,e.BLUE_SLATE_MEDIUM=new t(123,104,238),e.blueStaeMedium=R}(h=t.Purple||(t.Purple={}));var l;!function(e){function i(t){return void 0===t&&(t=1),new AColor(e.WHITE,t)}function r(t){return void 0===t&&(t=1),new AColor(e.SNOW,t)}function o(t){return void 0===t&&(t=1),new AColor(e.HONEYDEW,t)}function n(t){return void 0===t&&(t=1),new AColor(e.MIND_CREAM,t)}function s(t){return void 0===t&&(t=1),new AColor(e.AZURE,t)}function a(t){return void 0===t&&(t=1),new AColor(e.BLUE_ALICE,t)}function u(t){return void 0===t&&(t=1),new AColor(e.WHITE_GHOST,t)}function h(t){return void 0===t&&(t=1),new AColor(e.WHITE_SMOKE,t)}function l(t){return void 0===t&&(t=1),new AColor(e.SEASHELL,t)}function p(t){return void 0===t&&(t=1),new AColor(e.BEIGE,t)}function f(t){return void 0===t&&(t=1),new AColor(e.OLDLACE,t)}function c(t){return void 0===t&&(t=1),new AColor(e.WHITE_FLORAL,t)}function d(t){return void 0===t&&(t=1),new AColor(e.IVORY,t)}function g(t){return void 0===t&&(t=1),new AColor(e.WHITE_ANTIQUE,t)}function m(t){return void 0===t&&(t=1),new AColor(e.LINEN,t)}function E(t){return void 0===t&&(t=1),new AColor(e.LAVENDER_BLUSH,t)}function A(t){return void 0===t&&(t=1),new AColor(e.ROSE_MISTY,t)}e.WHITE=new t(255,255,255),e.white=i,e.SNOW=new t(255,250,250),e.snow=r,e.HONEYDEW=new t(240,255,240),e.honeydew=o,e.MIND_CREAM=new t(245,255,250),e.mindCream=n,e.AZURE=new t(240,255,255),e.azure=s,e.BLUE_ALICE=new t(240,248,255),e.blueAlice=a,e.WHITE_GHOST=new t(248,248,255),e.whiteGhost=u,e.WHITE_SMOKE=new t(245,245,245),e.whiteSmoke=h,e.SEASHELL=new t(255,245,238),e.seashell=l,e.BEIGE=new t(245,245,220),e.beige=p,e.OLDLACE=new t(253,245,230),e.oldlace=f,e.WHITE_FLORAL=new t(255,250,240),e.whiteFloral=c,e.IVORY=new t(255,255,240),e.ivory=d,e.WHITE_ANTIQUE=new t(250,235,215),e.whiteAntique=g,e.LINEN=new t(250,240,230),e.linen=m,e.LAVENDER_BLUSH=new t(255,240,245),e.lavandarBlush=E,e.ROSE_MISTY=new t(255,228,225),e.roseMisty=A}(l=t.White||(t.White={}));var p;!function(e){function i(t){return void 0===t&&(t=1),new AColor(e.GAINSBORO,t)}function r(t){return void 0===t&&(t=1),new AColor(e.GRAY_LIGHT,t)}function o(t){return void 0===t&&(t=1),new AColor(e.SILVER,t)}function n(t){return void 0===t&&(t=1),new AColor(e.GRAY_DARK,t)}function s(t){return void 0===t&&(t=1),new AColor(e.GRAY,t)}function a(t){return void 0===t&&(t=1),new AColor(e.GRAY_DIM,t)}function u(t){return void 0===t&&(t=1),new AColor(e.GRAY_SLATE_LIGHT,t)}function h(t){return void 0===t&&(t=1),new AColor(e.GRAY_SLATE,t)}function l(t){return void 0===t&&(t=1),new AColor(e.GRAY_SLATE_DARK,t)}function p(t){return void 0===t&&(t=1),new AColor(e.BLACK,t)}e.GAINSBORO=new t(220,220,220),e.gainsboro=i,e.GRAY_LIGHT=new t(211,211,211),e.grayLight=r,e.SILVER=new t(192,192,192),e.silver=o,e.GRAY_DARK=new t(169,169,169),e.grayDark=n,e.GRAY=new t(128,128,128),e.gray=s,e.GRAY_DIM=new t(105,105,105),e.grayDim=a,e.GRAY_SLATE_LIGHT=new t(119,136,153),e.graySlateLight=u,e.GRAY_SLATE=new t(112,128,144),e.graySlate=h,e.GRAY_SLATE_DARK=new t(47,79,79),e.graySlateDark=l,e.BLACK=new t(0,0,0),e.black=p}(p=t.Gray||(t.Gray={}))}(Color||(Color={}));var NUMBER_COMPARE=function(t,e){return t-e},STRING_COMPARE=function(t,e){return t.localeCompare(e)},Comparable=function(){function t(t){this.compare=t}return t}(),RBColor;!function(t){t[t.RED=0]="RED",t[t.BLACK=1]="BLACK"}(RBColor||(RBColor={}));var RBItemNode=function(){function t(t,e,i){this.color=e,this.key=t,this.size=i}return t}(),TreeSet=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.clear=function(){this.root=null},e.prototype.isEqual=function(t){if(this.size()!=t.size())return!1;for(var e=this.iterator(),i=t.iterator(),r=0;r<e.length;r++)if(e[r]!=i[r])return!1;return!0},e.prototype.size=function(){return null!=this.root?this.sizeAt(this.root):0},e.prototype.sizeAt=function(t){return null==t?0:t.size},e.prototype.childSize=function(t){return this.sizeAt(t.left)+this.sizeAt(t.right)},e.prototype.isEmpty=function(){return 0==this.size()},e.prototype.isRed=function(t){return null==t?!1:t.color==RBColor.RED},e.prototype.applyAt=function(t,e){if(null==t)return null;var i=this.compare(e,t.key);return 0>i?this.applyAt(t.left,e):i>0?this.applyAt(t.right,e):t.key},e.prototype.contains=function(t){return null!=this.applyAt(this.root,t)},e.prototype.pick=function(){return this.root.key},e.prototype.add=function(t){this.root=this.putAt(this.root,t),this.root.color=RBColor.BLACK},e.prototype.putAt=function(t,e){if(null==t)return new RBItemNode(e,RBColor.RED,1);var i=this.compare(e,t.key);return 0>i?t.left=this.putAt(t.left,e):i>0?t.right=this.putAt(t.right,e):t.key,this.isRed(t.right)&&!this.isRed(t.left)&&(t=this.leftRot(t)),this.isRed(t.left)&&this.isRed(t.left.left)&&(t=this.rightRot(t)),this.isRed(t.left)&&this.isRed(t.right)&&this.flipColors(t),t.size=this.sizeAt(t.left)+this.sizeAt(t.right)+1,t},e.prototype.rightRot=function(t){return this.rotate(t,!1)},e.prototype.leftRot=function(t){return this.rotate(t,!0)},e.prototype.rotate=function(t,e){var i=e?t.right:t.left;return e?(t.right=i.left,i.left=t,i.color=i.left.color,i.left.color=RBColor.RED,i.size=t.size):(t.left=i.right,i.right=t,i.color=i.right.color,i.right.color=RBColor.RED,i.size=t.size),t.size=this.childSize(t)+1,i},e.prototype.flipColors=function(t){this.flipColor(t),null!=t.left&&this.flipColor(t.left),null!=t.right&&this.flipColor(t.right)},e.prototype.flipColor=function(t){switch(t.color){case RBColor.BLACK:t.color=RBColor.RED;case RBColor.RED:t.color=RBColor.BLACK}},e.prototype.redToLeft=function(t){return this.flipColors(t),this.isRed(t.right.left)&&(t.right=this.rightRot(t.right),t=this.leftRot(t),this.flipColors(t)),t},e.prototype.redToRight=function(t){return this.flipColors(t),this.isRed(t.left.left)&&(t=this.rightRot(t.right),this.flipColors(t)),t},e.prototype.balance=function(t){return this.isRed(t.right)&&(t=this.leftRot(t)),this.isRed(t.left)&&this.isRed(t.left.left)&&(t=this.rightRot(t)),this.isRed(t.left)&&this.isRed(t.right)&&this.flipColors(t),t.size=this.childSize(t)+1,t},e.prototype.iterator=function(){var t=[];return this.iteratorAt(this.root,t),t},e.prototype.iteratorAt=function(t,e){null!=t&&(e.push(t.key),this.iteratorAt(t.left,e),this.iteratorAt(t.right,e))},e.prototype.remove=function(t){return this.contains(t)?(this.isRed(this.root.left)||this.isRed(this.root.right)||(this.root.color=RBColor.RED),this.root=this.removeAt(this.root,t),void(this.isEmpty()||(this.root.color=RBColor.BLACK))):!1},e.prototype.removeAt=function(t,e){if(this.compare(e,t.key)<0)this.isRed(t.left)||this.isRed(t.left.left)||(t=this.redToLeft(t)),t.left=this.removeAt(t.left,e);else{if(this.isRed(t.left)&&(t=this.rightRot(t)),0==this.compare(e,t.key)&&null==t.right)return null;if(this.isRed(t.right)||this.isRed(t.right.left)||(t=this.redToRight(t)),0==this.compare(e,t.key)){var i=this.minAt(t.right);t.key=i.key,t.right=this.deleteMinAt(t.right)}else t.right=this.removeAt(t.right,e)}return this.balance(t)},e.prototype.min=function(){return this.isEmpty()?null:this.minAt(this.root).key},e.prototype.minAt=function(t){return null==t.left?t:this.minAt(t.left)},e.prototype.max=function(){return this.isEmpty()?null:this.maxAt(this.root).key},e.prototype.maxAt=function(t){return null==t.right?t:this.minAt(t.right)},e.prototype.deleteMin=function(){this.isEmpty()||(this.isRed(this.root.left)||this.isRed(this.root.right)||(this.root.color=RBColor.RED),this.root=this.deleteMinAt(this.root),this.isEmpty()||(this.root.color=RBColor.BLACK))},e.prototype.deleteMinAt=function(t){return null==t.left?null:(this.isRed(t.left)||this.isRed(t.left.left)||(t=this.redToLeft(t)),t.left=this.deleteMinAt(t.left),this.balance(t))},e.prototype.deleteMax=function(){this.isEmpty()||(this.isRed(this.root.left)||this.isRed(this.root.right)||(this.root.color=RBColor.RED),this.root=this.deleteMaxAt(this.root),this.isEmpty()||(this.root.color=RBColor.BLACK))},e.prototype.deleteMaxAt=function(t){return this.isRed(t.left)&&(t=this.rightRot(t)),null==t.right?null:(this.isRed(t.right)||this.isRed(t.right.left)||(t=this.redToRight(t)),t.right=this.deleteMaxAt(t.right),this.balance(t))},e.prototype.floor=function(t){if(this.isEmpty)return null;var e=this.floorAt(this.root,t);return null==e?null:e.key},e.prototype.floorAt=function(t,e){if(null==t)return null;var i=this.compare(e,t.key);if(0==i)return t;if(0>i)return this.floorAt(t.left,e);var r=this.floorAt(t.right,e);return null==r?null:r},e.prototype.ceil=function(t){if(this.isEmpty)return null;var e=this.ceilAt(this.root,t);return null==e?null:e.key},e.prototype.ceilAt=function(t,e){if(null==t)return null;var i=this.compare(e,t.key);if(0==i)return t;if(i>0)return this.floorAt(t.right,e);var r=this.floorAt(t.left,e);return null==r?null:r},e}(Comparable),RBNode=function(t){function e(e,i,r,o){t.call(this,e,r,o),this.value=i}return __extends(e,t),e}(RBItemNode),TreeMap=function(t){function e(e){t.call(this,e)}return __extends(e,t),e.prototype.clear=function(){this.root=null},e.prototype.isEqual=function(t){if(this.size()!=t.size())return!1;for(var e=this.itterator(),i=t.itterator(),r=0;r<e.length;r++)if(e[r][0]!=i[r][0]||e[r][1]!=i[r][1])return!1;return!0},e.prototype.size=function(){return null!=this.root?this.sizeAt(this.root):0},e.prototype.sizeAt=function(t){return null==t?0:t.size},e.prototype.childSize=function(t){return this.sizeAt(t.left)+this.sizeAt(t.right)},e.prototype.isEmpty=function(){return 0==this.size()},e.prototype.isRed=function(t){return null==t?!1:t.color==RBColor.RED},e.prototype.apply=function(t){return this.applyAt(this.root,t)},e.prototype.applyAt=function(t,e){if(null==t)return null;var i=this.compare(e,t.key);return 0>i?this.applyAt(t.left,e):i>0?this.applyAt(t.right,e):t.value},e.prototype.contains=function(t){return null!=this.apply(t)},e.prototype.put=function(t,e){this.root=this.putAt(this.root,t,e),this.root.color=RBColor.BLACK},e.prototype.putAt=function(t,e,i){if(null==t)return new RBNode(e,i,RBColor.RED,1);var r=this.compare(e,t.key);return 0>r?t.left=this.putAt(t.left,e,i):r>0?t.right=this.putAt(t.right,e,i):t.value=i,this.isRed(t.right)&&!this.isRed(t.left)&&(t=this.leftRot(t)),this.isRed(t.left)&&this.isRed(t.left.left)&&(t=this.rightRot(t)),this.isRed(t.left)&&this.isRed(t.right)&&this.flipColors(t),t.size=this.sizeAt(t.left)+this.sizeAt(t.right)+1,t},e.prototype.rightRot=function(t){return this.rotate(t,!1)},e.prototype.leftRot=function(t){return this.rotate(t,!0)},e.prototype.rotate=function(t,e){var i=e?t.right:t.left;return e?(t.right=i.left,i.left=t,i.color=i.left.color,i.left.color=RBColor.RED,i.size=t.size):(t.left=i.right,i.right=t,i.color=i.right.color,i.right.color=RBColor.RED,i.size=t.size),t.size=this.childSize(t)+1,i},e.prototype.flipColors=function(t){this.flipColor(t),null!=t.left&&this.flipColor(t.left),null!=t.right&&this.flipColor(t.right)},e.prototype.flipColor=function(t){switch(t.color){case RBColor.BLACK:t.color=RBColor.RED;case RBColor.RED:t.color=RBColor.BLACK}},e.prototype.redToLeft=function(t){return this.flipColors(t),this.isRed(t.right.left)&&(t.right=this.rightRot(t.right),t=this.leftRot(t),this.flipColors(t)),t},e.prototype.redToRight=function(t){return this.flipColors(t),this.isRed(t.left.left)&&(t=this.rightRot(t.right),this.flipColors(t)),t},e.prototype.balance=function(t){return this.isRed(t.right)&&(t=this.leftRot(t)),this.isRed(t.left)&&this.isRed(t.left.left)&&(t=this.rightRot(t)),this.isRed(t.left)&&this.isRed(t.right)&&this.flipColors(t),t.size=this.childSize(t)+1,t},e.prototype.itterator=function(){var t=[];return this.itteratorAt(this.root,t),t},e.prototype.itteratorAt=function(t,e){null!=t&&(e.push([t.key,t.value]),this.itteratorAt(t.left,e),this.itteratorAt(t.right,e))},e.prototype.keys=function(){var t=[];return this.keysAt(this.root,t),t},e.prototype.keysAt=function(t,e){null!=t&&(e.push(t.key),this.keysAt(t.left,e),this.keysAt(t.right,e))},e.prototype.values=function(){var t=[];return this.valuesAt(this.root,t),t},e.prototype.valuesAt=function(t,e){null!=t&&(e.push(t.value),this.valuesAt(t.left,e),this.valuesAt(t.right,e))},e.prototype.remove=function(t){return this.contains(t)?(this.isRed(this.root.left)||this.isRed(this.root.right)||(this.root.color=RBColor.RED),this.root=this.removeAt(this.root,t),void(this.isEmpty()||(this.root.color=RBColor.BLACK))):!1},e.prototype.removeAt=function(t,e){if(this.compare(e,t.key)<0)this.isRed(t.left)||this.isRed(t.left.left)||(t=this.redToLeft(t)),t.left=this.removeAt(t.left,e);else{if(this.isRed(t.left)&&(t=this.rightRot(t)),0==this.compare(e,t.key)&&null==t.right)return null;if(this.isRed(t.right)||this.isRed(t.right.left)||(t=this.redToRight(t)),0==this.compare(e,t.key)){var i=this.minAt(t.right);t.key=i.key,t.value=i.value,t.right=this.deleteMinAt(t.right)}else t.right=this.removeAt(t.right,e)}return this.balance(t)},e.prototype.min=function(){return this.isEmpty()?null:this.minAt(this.root).key},e.prototype.minAt=function(t){return null==t.left?t:this.minAt(t.left)},e.prototype.max=function(){return this.isEmpty()?null:this.maxAt(this.root).key},e.prototype.maxAt=function(t){return null==t.right?t:this.minAt(t.right)},e.prototype.deleteMin=function(){this.isEmpty()||(this.isRed(this.root.left)||this.isRed(this.root.right)||(this.root.color=RBColor.RED),this.root=this.deleteMinAt(this.root),this.isEmpty()||(this.root.color=RBColor.BLACK))},e.prototype.deleteMinAt=function(t){return null==t.left?null:(this.isRed(t.left)||this.isRed(t.left.left)||(t=this.redToLeft(t)),t.left=this.deleteMinAt(t.left),this.balance(t))},e.prototype.deleteMax=function(){this.isEmpty()||(this.isRed(this.root.left)||this.isRed(this.root.right)||(this.root.color=RBColor.RED),this.root=this.deleteMaxAt(this.root),this.isEmpty()||(this.root.color=RBColor.BLACK))},e.prototype.deleteMaxAt=function(t){return this.isRed(t.left)&&(t=this.rightRot(t)),null==t.right?null:(this.isRed(t.right)||this.isRed(t.right.left)||(t=this.redToRight(t)),t.right=this.deleteMaxAt(t.right),this.balance(t))},e.prototype.floor=function(t){if(this.isEmpty)return null;var e=this.floorAt(this.root,t);return null==e?null:e.key},e.prototype.floorAt=function(t,e){if(null==t)return null;var i=this.compare(e,t.key);if(0==i)return t;if(0>i)return this.floorAt(t.left,e);var r=this.floorAt(t.right,e);return null==r?null:r},e.prototype.ceil=function(t){if(this.isEmpty)return null;var e=this.ceilAt(this.root,t);return null==e?null:e.key},e.prototype.ceilAt=function(t,e){if(null==t)return null;var i=this.compare(e,t.key);if(0==i)return t;if(i>0)return this.floorAt(t.right,e);var r=this.floorAt(t.left,e);return null==r?null:r},e}(Comparable),DeepTreeMap=function(){function t(t){this.map=new TreeMap(t)}return t.prototype.put=function(t,e){this.contains(t)||this.map.put(t,new Bag),this.map.apply(t).insert(e)},t.prototype.putAll=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.contains(t)||this.map.put(t,new Bag),this.map.apply(t).insertArray(e)},t.prototype.putArray=function(t,e){this.contains(t)||this.map.put(t,new Bag),this.map.apply(t).insertArray(e)},t.prototype.itterator=function(t){var e=this.map.apply(t);return null!=e?e.iterator():[]},t.prototype.clear=function(){this.map.clear()},t.prototype.isEqual=function(t){return this.map.isEqual(t.map)},t.prototype.size=function(t){return"undefined"==typeof t?this.map.size():this.map.apply(t).size()},t.prototype.isEmpty=function(){return 0==this.size()},t.prototype.apply=function(t){return this.map.apply(t)},t.prototype.contains=function(t){return null!=this.apply(t)},t.prototype.remove=function(t){return this.map.remove(t)},t}(),List=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];"undefined"!=typeof t&&t.length>0?this.data=t:this.data=[]}return t.prototype.filter=function(t){for(var e=(this.clone(),this.iterator()),i=this.empty(),r=0;r<this.size();r++)t(e[r],r,e)&&i.data.push(e[r]);return i},t.prototype.map=function(e){for(var i=(this.clone(),this.iterator()),r=new t,o=0;o<this.size();o++)r.data.push(e(r[o],o,i));return r},t.prototype.empty=function(){return new t},t.prototype.foreach=function(t){this.data.forEach(t)},t.prototype.isEmpty=function(){return 0==this.size()},t.prototype.size=function(){return this.data.length},t.prototype.iterator=function(){return this.data.slice()},t.prototype.toArray=function(){return this.data},t.prototype.join=function(t){this.data=this.toArray().concat(t.toArray())},t.prototype.apply=function(t){return this.data[t]},t.prototype.clone=function(){var e=this.iterator(),i=new t;return i.data=e,i},t.prototype.isEqual=function(t){if(this.size()!=t.size())return!1;for(var e=0;e<this.size();e++)if(this.data[e]!=t.data[e])return!1;return!0},t.prototype.exch=function(t,e){var i=this.data[t],r=this.data[e];this.data[t]=r,this.data[e]=i},t.exch=function(t,e,i){var r=t[e],o=t[i];t[e]=o,t[i]=r},t}(),Bag=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.insert=function(t){this.data.push(t)},e.prototype.insertAll=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];for(var i=0;i<t.length;i++)this.insert(t[i])},e.prototype.insertArray=function(t){for(var e=0;e<t.length;e++)this.insert(t[e])},e.prototype.clone=function(){var t=this.iterator(),i=new e;return i.data=t,i},e.prototype.empty=function(){return new e},e.prototype.filter=function(e){return t.prototype.filter.call(this,e)},e.prototype.clear=function(){this.data=[]},e}(List),MutableList=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.remove=function(t){var e=this.indexOf(t);return e>=0&&this.removeAt(e),e},e.prototype.removeAt=function(t){return this.data.splice(t,1)[0]},e.prototype.replace=function(t,e,i){this.data[t]=i},e.prototype.indexOf=function(t){return this.data.indexOf(t)},e.prototype.contains=function(t){return this.indexOf(t)>=0},e.prototype.clear=function(){this.data=[]},e.prototype.clone=function(){var t=this.iterator(),i=new e;return i.data=t,i},e.prototype.empty=function(){return new e},e.prototype.filter=function(e){return t.prototype.filter.call(this,e)},e}(Bag),Queue=function(t){function e(){t.apply(this,arguments),this.low=0}return __extends(e,t),e.prototype.size=function(){return t.prototype.size.call(this)-this.low},e.prototype.enqueue=function(t){this.data.push(t)},e.prototype.dequeue=function(){var t=this.sample();return delete this.data[this.low],this.low++,this.data.length>=16&&this.low>=2*this.size()&&this.toArray(),t},e.prototype.sample=function(){return this.apply(this.low)},e.prototype.toArray=function(){return this.data=this.data.slice(this.low,this.data.length),this.low=0,this.data},e.prototype.iterator=function(){return this.data.slice(this.low,this.data.length)},e.prototype.clear=function(){this.data=[]},e.prototype.clone=function(){var t=this.iterator(),i=new e;return i.data=t,i.low=this.low,i},e.prototype.empty=function(){return new e},e.prototype.filter=function(e){return t.prototype.filter.call(this,e)},e}(List),Stack=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.push=function(t){this.data.push(t)},e.prototype.pop=function(){return this.data.pop()},e.prototype.sample=function(){return this.data[this.size()-1]},e.prototype.clear=function(){this.data=[]},e.prototype.clone=function(){var t=this.iterator(),i=new e;return i.data=t,i},e.prototype.empty=function(){return new e},e.prototype.filter=function(e){return t.prototype.filter.call(this,e)},e}(List),ComparableList=function(t){function e(e){for(var i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];t.call(this),"undefined"!=typeof i&&(this.data=i),this.compare=e}return __extends(e,t),e.prototype.sort=function(){return this.iterator().sort(this.compare)},e.prototype.empty=function(){return new e(this.compare)},e.prototype.filter=function(e){return t.prototype.filter.call(this,e)},e.prototype.less=function(t,e){return this.compare(this.data[t],this.data[e])<0},e.prototype.more=function(t,e){return this.compare(this.data[t],this.data[e])>0},e.prototype.equal=function(t,e){return 0==this.compare(this.data[t],this.data[e])},e.less=function(t,e,i,r){return e(t[i],t[r])<0},e.more=function(t,e,i,r){return e(t[i],t[r])>0},e.equal=function(t,e,i,r){return 0==e(t[i],t[r])},e}(List),Heap=function(t){function e(i,r){for(var o=[],n=2;n<arguments.length;n++)o[n-2]=arguments[n];if(this.isMaxList=r,!r){var s=i;i=function(t,e){return s(e,t)}}t.call(this,i),"undefined"!=typeof o?this.data=e.heapefy(o.slice(),i,!0):this.data=[]}return __extends(e,t),e.prototype.insertAll=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];for(var i=0;i<t.length;i++)this.insert(t[i])},e.prototype.insertArray=function(t){for(var e=0;e<t.length;e++)this.insert(t[e])},e.prototype.insert=function(t){this.data.push(t),this.swim(this.size()-1)},e.prototype.clear=function(){this.data=[]},e.prototype.empty=function(){return new e(this.compare,this.isMaxList)},e.prototype.filter=function(e){return t.prototype.filter.call(this,e)},e.prototype.pop=function(){this.exch(0,this.size()-1);var t=this.data.pop();return this.sink(0),t},e.prototype.sample=function(){return this.data[0]},e.prototype.join=function(t){this.insertArray(t.toArray())},e.prototype.sort=function(){return e.sort(this.iterator(),this.compare,!0,!0)},e.prototype.clone=function(){var t=this.iterator(),i=new e(this.compare,this.isMaxList);return i.data=t,i},e.sort=function(t,i,r,o){if(!r){var n=i;i=function(t,e){return n(e,t)}}"undefined"!=typeof o&&o||e.heapefy(t,i,!0);for(var s=t.length;s>0;)List.exch(t,0,s-1),e.sink(t,i,0,--s);return t},e.heapefy=function(t,i,r){if(!r){var o=i;i=function(t,e){return o(e,t)}}for(var n=t.length,s=Math.ceil(n/2);s>=0;s--)e.sink(t,i,s,n);return t},e.prototype.swim=function(t){for(var e=Math.floor((t-1)/2);t>0&&this.less(e,t);)this.exch(t,e),t=e,e=Math.floor((t-1)/2)},e.prototype.sink=function(t){for(var e=2*t+1;e<this.size()&&(e<this.size()-1&&this.less(e,e+1)&&e++,this.less(t,e));)this.exch(t,e),t=e,e=2*t+1},e.sink=function(t,e,i,r){for(var o=2*i+1;r>o&&(r-1>o&&ComparableList.less(t,e,o,o+1)&&o++,ComparableList.less(t,e,i,o));)List.exch(t,i,o),i=o,o=2*i+1},e}(ComparableList),PriorityQueue=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.dequeue=function(){return this.pop()},e.prototype.clone=function(){var t=this.iterator(),i=new e(this.compare,this.isMaxList);return i.data=t,i},e.prototype.empty=function(){return new e(this.compare,this.isMaxList)},e.prototype.filter=function(e){return t.prototype.filter.call(this,e)},e}(Heap);